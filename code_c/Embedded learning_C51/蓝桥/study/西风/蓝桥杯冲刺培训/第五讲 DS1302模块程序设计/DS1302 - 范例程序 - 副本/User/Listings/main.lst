C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /* å¤´æ–‡ä»¶å£°æ˜åŒº */
   2          #include <STC15F2K60S2.H>//å•ç‰‡æœºå¯„å­˜å™¨ä¸“ç”¨å¤´æ–‡ä»¶
   3          #include <Init.h>//åˆå§‹åŒ–åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   4          #include <Led.h>//Ledåº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   5          #include <Key.h>//æŒ‰é”®åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   6          #include <Seg.h>//æ•°ç ç®¡åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   7          #include "ds1302.h"//DS1302åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   8          #include <string.h>//memcpyå‡½æ•°ä¸“ç”¨å¤´æ–‡ä»¶
   9          
  10          
  11          /* å˜é‡å£°æ˜åŒº */
  12          unsigned char Key_Val,Key_Down,Key_Old,Key_Up;//æŒ‰é”®ä¸“ç”¨å˜é‡
  13          unsigned char Key_Slow_Down;//æŒ‰é”®å‡é€Ÿä¸“ç”¨å˜é‡
  14          unsigned char Seg_Buf[8] = {10,10,10,10,10,10,10,10};//æ•°ç ç®¡æ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  15          unsigned char Seg_Point[8] = {0,0,0,0,0,0,0,0};//æ•°ç ç®¡å°æ•°ç‚¹æ•°æ®å­˜æ”¾æ•°ç»„
  16          unsigned char Seg_Pos;//æ•°ç ç®¡æ‰«æä¸“ç”¨å˜é‡
  17          unsigned int Seg_Slow_Down;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨å˜é‡
  18          unsigned char ucLed[8] = {0,0,0,0,0,0,0,0};//Ledæ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  19          unsigned char Seg_Disp_Mode;//æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼å˜é‡ 0-æ—¶é’Ÿæ˜¾ç¤º 1-é—¹é’Ÿæ˜¾ç¤º 2-æ—¥æœŸæ˜¾ç¤º 3-æ
             -—¶é’Ÿè®¾ç½® 4-é—¹é’Ÿè®¾ç½® 5-æ—¥æœŸè®¾ç½®
  20          unsigned char ucRtc[3] = {0x23,0x59,0x55};//æ—¶é’Ÿæ•°æ®å­˜æ”¾æ•°ç»„ ä¸Šç”µåˆå§‹åŒ–æ—¶é—´ 23:59:55
  21          unsigned char ucDate[3] = {0x22,0x12,0x12};//æ—¥æœŸæ•°æ®å­˜æ”¾æ•°ç»„ ä¸Šç”µåˆå§‹åŒ–æ—¥æœŸ 22-12-12
  22          unsigned char ucAlarm[9] = {0x00,0x00,0x00,0x00,0x10,0x00,0xbb,0xbb,0xbb};//é—¹é’Ÿæ•°æ®å­˜æ”¾æ•°ç»„ ä¸‰ç»
             -„é—¹é’Ÿ æœªå¯ç”¨0xbbè¡¨ç¤º
  23          unsigned char Alarm_Dat_Index;//é—¹é’Ÿæ•°ç»„æŒ‡é’ˆ ä»£è¡¨å½“å‰é—¹é’Ÿç¼–å·
  24          unsigned char Set_Dat[9];//è®¾ç½®æ•°æ®å­˜æ”¾æ•°ç»„ å¦‚æœä¸‰ä¸ªæ¨¡å¼å®šä¹‰ä¸‰ä¸ªä¸åŒçš„è®¾ç½®æ•°ç»„ä¼š
             -å¤§é‡å ç”¨èµ„æº åˆå› ä¸ºè¿™ä¸‰ä¸ªæ¨¡å¼åœ¨è®¾ç½®çŠ¶æ€ä¸‹å¹¶ä¸ä¼šäº’ç›¸å½±å“ï¼ˆäº’æ–¥å­˜åœ¨å…³ç³»ï¼‰ æ‰€ä»¥åªéœ€è
             -¦å®šä¹‰ä¸€ä¸ªè®¾ç½®æ•°ç»„ æ ¹æ®ä¸åŒçš„ç•Œé¢å°†ä¸åŒçš„æ•°æ®èµ‹å€¼ç»™è¿™ä¸ªæ•°ç»„
  25          unsigned int Timer_500Ms;//äº”ç™¾æ¯«ç§’è®¡æ—¶å˜é‡
  26          unsigned char* Set_Flag[3] = {ucRtc,ucAlarm,ucDate};//æŒ‡é’ˆæ•°ç»„ ç®€åŒ–æ•°æ®èµ‹å€¼ä¸“ç”¨
  27          unsigned char Input_Index;//è¾“å…¥ä½æ•°å˜é‡ ç”¨äºåˆ¤æ–­å“ªä¸ªå•å…ƒæ ¼éœ€è¦é—ªçƒ
  28          unsigned char Beep_Index;//ç”¨äºè®°å½•å“ªä¸ªé—¹é’Ÿä½¿èƒ½çš„å˜é‡
  29          unsigned char Timer_200Ms;//ä¸¤ç™¾æ¯«ç§’è®¡æ—¶å˜é‡
  30          bit Input_Flag;//è¾“å…¥æ ‡å¿—ä½ ç”¨äºåˆ¤æ–­è¾“å…¥åä½è¿˜æ˜¯ä¸ªä½
  31          bit Seg_Star_Flag;//æ•°ç ç®¡é—ªçƒæ ‡å¿—ä½
  32          bit Beep_Flag;//é—¹é’Ÿä½¿èƒ½æ ‡å¿—ä½
  33          bit Beep_Enable_Flag = 1;//é—¹é’ŸåŠŸèƒ½å¼€å¯æ ‡å¿—ä½
  34          bit Led_Star_Flag;//Ledé—ªçƒæ ‡å¿—ä½
  35          
  36          /* æ•°æ®åˆ¤æ–­å‡½æ•° */
  37          unsigned char Dat_Judgment(unsigned char* Dat,unsigned char mode)//ç¬¬ä¸€ä¸ªå…¥å£å‚æ•°ä¸ºéœ€è¦åˆ¤æ–­çš„
             -æ•°ç»„åœ°å€ ç¬¬äºŒä¸ªå…¥å£å‚æ•°ä¸ºéœ€è¦åˆ¤æ–­çš„æ¨¡å¼ï¼ˆå¹´æœˆæ—¥ã€æ—¶åˆ†ç§’ï¼‰
  38          {
  39   1        unsigned char i;//ç”¨äºForå¾ªç¯
  40   1        unsigned int Dat_Array[3];//åè¿›åˆ¶æ•°æ®å­˜æ”¾æ•°ç»„ å°†BCDç è½¬æ¢æˆåè¿›åˆ¶ä¾¿äºæ¯”è¾ƒ
  41   1        for(i=0;i<3;i++)
  42   1        {
  43   2          Dat_Array[i] = ((*Dat / 16) % 10 ) * 10 + ((*Dat % 16) % 10);// % 10çš„ç›®çš„æ˜¯ä¸ºäº†è®©è¢«åˆ é™¤çš„é—¹
             -é’Ÿåœ¨åˆ¤æ–­æ—¶ä¸å¯¹æ•°æ®é€ æˆå½±å“
  44   2          Dat++;
  45   2        }
  46   1        if(mode == 2)//æ—¥æœŸåˆ¤æ–­
  47   1        {
  48   2          Dat_Array[0] += 2000;//å°†å¹´å˜ä¸º20XXçš„æ ¼å¼ä¾¿äºä¸‹é¢çš„åˆ¤æ–­
C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 2   

  49   2          if(Dat_Array[1] < 1 || Dat_Array[1] > 12) //å¦‚æœæœˆä»½ä¸åœ¨1-12ä¹‹é—´
  50   2            return 0;//è¿”å›é”™è¯¯
  51   2          if(Dat_Array[2] < 1 || Dat_Array[2] > 31) //å¦‚æœæ—¥æœŸä¸åœ¨1-31ä¹‹é—´
  52   2            return 0;
  53   2          if(Dat_Array[1] == 2 && Dat_Array[2] == 29)//æ£€æŸ¥2.29æ˜¯å¦æœ‰æ•ˆ
  54   2          {
  55   3            if((Dat_Array[0] % 4 == 0 && Dat_Array[0] % 100 != 0) || Dat_Array[0] % 400) //é—°å¹´æ¡ä»¶ï¼šèƒ½è¢«4æ•
             -´é™¤ä½†æ˜¯ä¸èƒ½è¢«100æ•´é™¤ æˆ–è€… èƒ½è¢«400æ•´é™¤
  56   3              return 1;//è¿”å›æ­£ç¡®
  57   3            else
  58   3              return 0;//è¿”å›é”™è¯¯
  59   3          }
  60   2          if(Dat_Array[1] == 4 || Dat_Array[1] == 6 || Dat_Array[1] == 9 || Dat_Array[1] == 11)//æ£€æŸ¥æ—¥æœŸæ˜¯å
             -¦æœ‰æ•ˆ
  61   2            return !(Dat_Array[2] / 30);//å¦‚æœæ—¥æœŸå¤§äº30 åˆ™è¿”å›0 åä¹‹è¿”å›1
  62   2        }
  63   1        else//æ—¶é—´åˆ¤æ–­
  64   1        {
  65   2          if(Dat_Array[0] > 23)//å¦‚æœæ—¶é’Ÿä¸åœ¨0-23ä¹‹é—´
  66   2            return 0;//è¿”å›é”™è¯¯
  67   2          if(Dat_Array[1] > 59 || Dat_Array[2] > 59)//å¦‚æœåˆ†é’Ÿæˆ–ç§’é’Ÿä¸åœ¨0-59ä¹‹é—´
  68   2            return 0;//è¿”å›é”™è¯¯
  69   2          return 1;//å…¶ä»–æƒ…å†µè¿”å›æ­£ç¡®
  70   2        }
  71   1      }
  72          
  73          /* é”®ç›˜å¤„ç†å‡½æ•° */
  74          void Key_Proc()
  75          {
  76   1        unsigned char i;//ç”¨äºForå¾ªç¯
  77   1        if(Key_Slow_Down) return;
  78   1        Key_Slow_Down = 1;//é”®ç›˜å‡é€Ÿç¨‹åº
  79   1      
  80   1        Key_Val = Key_Read();//å®æ—¶è¯»å–é”®ç å€¼
  81   1        Key_Down = Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸‹é™æ²¿
  82   1        Key_Up = ~Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸Šé™æ²¿
  83   1        Key_Old = Key_Val;//è¾…åŠ©æ‰«æå˜é‡
  84   1      
  85   1        /* é”®ç›˜è¾“å…¥åŒºåŸŸ */
  86   1        if(Key_Down >= 4 && Key_Down <= 13 && Input_Index < 3) //è¾“å…¥å®Œä¸€æ¬¡åå–æ¶ˆä½¿èƒ½ ä¿æŠ¤æ•°æ®
  87   1        {
  88   2          if(Seg_Disp_Mode >= 3)//å¤„äºå‚æ•°è®¾ç½®çŠ¶æ€
  89   2          {
  90   3            if(Input_Flag == 0)//è¾“å…¥åä½
  91   3              Set_Dat[Input_Index+3*Alarm_Dat_Index] = ((Key_Down - 4) << 4) | (Set_Dat[Input_Index+3*Alarm_Dat_Inde
             -x] & 0x0f);//å†™å…¥é«˜ä½
  92   3            else//è¾“å…¥ä¸ªä½
  93   3              Set_Dat[Input_Index+3*Alarm_Dat_Index] = (Set_Dat[Input_Index+3*Alarm_Dat_Index] & 0xf0) | (Key_Down -
             - 4);//å†™å…¥ä½ä½
  94   3            Input_Flag ^= 1;//æ ‡å¿—ä½å–å
  95   3            if(Input_Flag == 0)//å®Œæˆä¸€ä¸ªå‘¨æœŸ ä»£è¡¨ä¸€ä¸ªå•å…ƒè¾“å…¥å®Œæˆ
  96   3              Input_Index++;
  97   3      //        Input_Index = (Input_Index + 1) % 3;//Input_Indexåœ¨0-2ä¹‹é—´å¾ªç¯ é€šç”¨è¡¨è¾¾å¼ä¸º:ï¼ˆå˜é‡-å¾ª
             -ç¯èµ·ç‚¹+1ï¼‰%ï¼ˆå¾ªç¯ç»ˆç‚¹-å¾ªç¯èµ·ç‚¹+1ï¼‰ + å¾ªç¯èµ·ç‚¹
  98   3          }
  99   2        }
 100   1        
 101   1        switch(Key_Down)
 102   1        {
 103   2          case 14://ç•Œé¢åˆ‡æ¢æŒ‰é”®
 104   2            if(Seg_Disp_Mode < 3) //åœ¨éå‚æ•°è®¾ç½®çŠ¶æ€ä¸‹ä½¿èƒ½
 105   2            {
C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 3   

 106   3              if(++Seg_Disp_Mode == 3) //åœ¨0-2ä¹‹é—´å¾ªç¯åˆ‡æ¢
 107   3                Seg_Disp_Mode = 0;
 108   3            }
 109   2          break;
 110   2          case 15://å‚æ•°è®¾ç½®æŒ‰é”®
 111   2            if(Seg_Disp_Mode < 3) //åœ¨éå‚æ•°è®¾ç½®çŠ¶æ€
 112   2            {
 113   3              Seg_Disp_Mode += 3;//åˆ‡æ¢åˆ°å¯¹åº”çš„è®¾ç½®ç•Œé¢å†…
 114   3              Alarm_Dat_Index = 0;//é—¹é’ŸæŒ‡é’ˆå¤ä½
 115   3              memcpy(Set_Dat,Set_Flag[Seg_Disp_Mode-3],9);//Set_Flagä¸ºæŒ‡é’ˆæ•°ç»„ Set_Flag[0] ä»£è¡¨ ucRtc æ•°ç»„ç
             -š„åœ°å€ ä»¥æ­¤ç±»æ¨
 116   3      //        switch(Seg_Disp_Mode)
 117   3      //        {
 118   3      //          case 3://åˆ‡æ¢åˆ°æ—¶é’Ÿè®¾ç½®ç•Œé¢
 119   3      //            memcpy(Set_Dat,ucRtc,9);
 120   3      //          break;
 121   3      //          case 4://åˆ‡æ¢åˆ°é—¹é’Ÿè®¾ç½®ç•Œé¢
 122   3      //            memcpy(Set_Dat,ucAlarm,9);
 123   3      //          break;  
 124   3      //          case 5://åˆ‡æ¢åˆ°æ—¥æœŸè®¾ç½®ç•Œé¢
 125   3      //            memcpy(Set_Dat,ucDate,9);
 126   3      //          break;            
 127   3      //        }
 128   3            }
 129   2            else//åœ¨å‚æ•°è®¾ç½®çŠ¶æ€ä¸‹
 130   2            {
 131   3              if(Input_Index == 3)//åªæœ‰è¾“å…¥å®Œä¸‰æ¬¡æ•°æ®åæ‰èƒ½ä½¿èƒ½ä¿å­˜æŒ‰é”®
 132   3              {
 133   4                if(Dat_Judgment(&Set_Dat[0],Seg_Disp_Mode-3) && Dat_Judgment(&Set_Dat[3],Seg_Disp_Mode-3) && Dat_Judg
             -ment(&Set_Dat[6],Seg_Disp_Mode-3))
 134   4                {
 135   5                  switch(Seg_Disp_Mode)
 136   5                  {
 137   6                    case 3:
 138   6                      Set_Rtc(Set_Dat);//è®¾ç½®æ–°çš„æ—¶é’Ÿæ•°æ®
 139   6                    break;
 140   6                    case 4:
 141   6                      memcpy(ucAlarm,Set_Dat,9);//ä¿å­˜é—¹é’Ÿæ•°æ®
 142   6                    break;
 143   6                    case 5:
 144   6                      Set_Date(Set_Dat);//è®¾ç½®æ–°çš„æ—¶é’Ÿæ•°æ®
 145   6                    break;
 146   6                  }
 147   5                  Seg_Disp_Mode -= 3;//è·³è½¬å›æ•°æ®æ˜¾ç¤ºç•Œé¢
 148   5                }
 149   4                else
 150   4                {
 151   5                  memcpy(Set_Dat,Set_Flag[Seg_Disp_Mode-3],9);//æ¸…é™¤è¾“å…¥æ•°æ®
 152   5                  Input_Index = Input_Flag = 0;//è¾“å…¥ç³»åˆ—æ•°æ®å¤ä½
 153   5                }
 154   4      //          switch(Seg_Disp_Mode)
 155   4      //          {
 156   4      //            case 3://æ—¶é’Ÿè®¾ç½®
 157   4      //              if(Dat_Judgment(Set_Dat,0))//åˆ¤æ–­æ—¶é’Ÿæ•°æ®æœ‰æ•ˆæ€§
 158   4      //              {
 159   4      //                Set_Rtc(Set_Dat);//è®¾ç½®æ–°çš„æ—¶é’Ÿæ•°æ®
 160   4      //                Seg_Disp_Mode = 0;//è·³è½¬å›æ—¶é’Ÿæ˜¾ç¤ºç•Œé¢
 161   4      //              }
 162   4      //              else//æ•°æ®ä¸åˆæ³•
 163   4      //              {
 164   4      //                memcpy(Set_Dat,ucRtc,9);//æ¸…é™¤è¾“å…¥æ•°æ®
 165   4      //                Input_Index = Input_Flag = 0;//è¾“å…¥ç³»åˆ—æ•°æ®å¤ä½
C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 4   

 166   4      //              }
 167   4      //            break;
 168   4      //            case 4://é—¹é’Ÿè®¾ç½®
 169   4      //              if(Dat_Judgment(&Set_Dat[0],1) && Dat_Judgment(&Set_Dat[3],1) && Dat_Judgment(&Set_Dat[6],1))//åˆ
             -¤æ–­ä¸‰ç»„é—¹é’Ÿæ•°æ®æœ‰æ•ˆæ€§
 170   4      //              {
 171   4      //                memcpy(ucAlarm,Set_Dat,9);//ä¿å­˜é—¹é’Ÿæ•°æ®
 172   4      //                Seg_Disp_Mode = 1;//è·³è½¬å›é—¹é’Ÿæ˜¾ç¤ºç•Œé¢
 173   4      //              }
 174   4      //              else//æ•°æ®ä¸åˆæ³•
 175   4      //              {
 176   4      //                memcpy(Set_Dat,ucAlarm,9);//æ¸…é™¤è¾“å…¥æ•°æ®
 177   4      //                Input_Index = Input_Flag = 0;//è¾“å…¥ç³»åˆ—æ•°æ®å¤ä½
 178   4      //              }
 179   4      //            break;
 180   4      //            case 5://æ—¥æœŸè®¾ç½®
 181   4      //              if(Dat_Judgment(Set_Dat,2))//åˆ¤æ–­æ—¥æœŸæ•°æ®æœ‰æ•ˆæ€§
 182   4      //              {
 183   4      //                Set_Date(Set_Dat);//è®¾ç½®æ–°çš„æ—¶é’Ÿæ•°æ®
 184   4      //                Seg_Disp_Mode = 2;//è·³è½¬å›æ—¶é’Ÿæ˜¾ç¤ºç•Œé¢
 185   4      //              }
 186   4      //              else//æ•°æ®ä¸åˆæ³•
 187   4      //              {
 188   4      //                memcpy(Set_Dat,ucDate,9);//æ¸…é™¤è¾“å…¥æ•°æ®
 189   4      //                Input_Index = Input_Flag = 0;//è¾“å…¥ç³»åˆ—æ•°æ®å¤ä½
 190   4      //              }
 191   4      //            break;
 192   4      //          }
 193   4              }
 194   3            }
 195   2          break;
 196   2          case 17://é—¹é’Ÿåˆ‡æ¢æŒ‰é”®
 197   2            if(Seg_Disp_Mode == 1 || Seg_Disp_Mode == 4) // å¤„äºé—¹é’Ÿæ˜¾ç¤ºç•Œé¢
 198   2            {
 199   3              if(++Alarm_Dat_Index == 3) //åœ¨0-2ä¹‹é—´å¾ªç¯åˆ‡æ¢
 200   3                Alarm_Dat_Index = 0;        
 201   3            }
 202   2          break;
 203   2          case 18://é—¹é’ŸåŠŸèƒ½æŒ‰é”®
 204   2            if(Seg_Disp_Mode < 3)//å¤„äºéå‚æ•°è®¾ç½®ç•Œé¢
 205   2              Beep_Enable_Flag ^= 1;
 206   2          break;
 207   2          case 19://é—¹é’Ÿåˆ é™¤æŒ‰é”®
 208   2            if(Seg_Disp_Mode == 4)//å¤„äºé—¹é’Ÿè®¾ç½®ç•Œé¢
 209   2            {
 210   3              for(i=0;i<3;i++)
 211   3                Set_Dat[3*Alarm_Dat_Index + i] = 0xbb;//æ¸…ç©ºæ•°æ®
 212   3              Input_Index = 0;
 213   3              Input_Flag = 0;
 214   3            }
 215   2          break;
 216   2        }
 217   1      }
 218          
 219          /* ä¿¡æ¯å¤„ç†å‡½æ•° */
 220          void Seg_Proc()
 221          {
 222   1        unsigned char i;//Forå¾ªç¯ä¸“ç”¨å˜é‡
 223   1        if(Seg_Slow_Down) return;
 224   1        Seg_Slow_Down = 1;//æ•°ç ç®¡å‡é€Ÿç¨‹åº
 225   1        
 226   1        /* ä¿¡æ¯è¯»å–åŒºåŸŸ */
C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 5   

 227   1        Read_Rtc(ucRtc);//è¯»å–å®æ—¶æ—¶é’Ÿæ•°æ®
 228   1        Read_Date(ucDate);//è¯»å–å®æ—¶æ—¥æœŸæ•°æ®
 229   1        
 230   1        /* æ•°æ®å¤„ç†åŒºåŸŸ */
 231   1        Seg_Buf[2] = Seg_Buf[5] = 11; //è¿™ä¸¤ä¸ªæ•°ç ç®¡ä¸ç®¡åœ¨ä»€ä¹ˆçŠ¶æ€ä¸‹éƒ½ä¸º -  å› æ­¤åªéœ€è¦å†™åœ¨
             -switchè¯­å¥å¤–é¢å³å¯
 232   1        
 233   1      //  switch(Seg_Disp_Mode)
 234   1      //  {
 235   1      //    case 0://æ—¶é’Ÿæ˜¾ç¤º
 236   1      //      for(i=0;i<3;i++)
 237   1      //      {
 238   1      //        Seg_Buf[3*i] = ucRtc[i] / 16;
 239   1      //        Seg_Buf[3*i+1] = ucRtc[i] % 16;
 240   1      //      }
 241   1      //    break;
 242   1      //    case 1://é—¹é’Ÿæ˜¾ç¤º
 243   1      //      for(i=0;i<3;i++)
 244   1      //      {
 245   1      //        Seg_Buf[3*i] = ucAlarm[i+3*Alarm_Dat_Index] / 16;
 246   1      //        Seg_Buf[3*i+1] = ucAlarm[i+3*Alarm_Dat_Index] % 16;
 247   1      //      } 
 248   1      //    break;
 249   1      //    case 2://æ—¥æœŸæ˜¾ç¤º
 250   1      //      for(i=0;i<3;i++)
 251   1      //      {
 252   1      //        Seg_Buf[3*i] = ucDate[i] / 16;
 253   1      //        Seg_Buf[3*i+1] = ucDate[i] % 16;
 254   1      //      } 
 255   1      //    break;
 256   1      //    default://å¤„äºå‚æ•°è®¾ç½®çŠ¶æ€
 257   1      //      for(i=0;i<3;i++)
 258   1      //      {
 259   1      //        Seg_Buf[3*i] = Set_Dat[i+3*Alarm_Dat_Index] / 16;
 260   1      //        Seg_Buf[3*i+1] = Set_Dat[i+3*Alarm_Dat_Index] % 16;
 261   1      //      }
 262   1      //  }
 263   1      
 264   1        if(Seg_Disp_Mode < 3)//å¤„äºå‚æ•°æ˜¾ç¤ºç•Œé¢
 265   1        {
 266   2          for(i=0;i<3;i++)
 267   2          {
 268   3            Seg_Buf[3*i] = Set_Flag[Seg_Disp_Mode][i+3*Alarm_Dat_Index] / 16;
 269   3            Seg_Buf[3*i+1] = Set_Flag[Seg_Disp_Mode][i+3*Alarm_Dat_Index] % 16;
 270   3          }     
 271   2        }
 272   1        else//å¤„äºè®¾ç½®å‚æ•°ç•Œé¢
 273   1        {
 274   2          for(i=0;i<3;i++)
 275   2          {
 276   3            Seg_Buf[3*i] = Set_Dat[i+3*Alarm_Dat_Index] / 16;
 277   3            Seg_Buf[3*i+1] = Set_Dat[i+3*Alarm_Dat_Index] % 16;
 278   3          }   
 279   2          Seg_Buf[3*Input_Index] = Seg_Star_Flag?Set_Dat[Input_Index+3*Alarm_Dat_Index] / 16:10;
 280   2          Seg_Buf[3*Input_Index+1] = Seg_Star_Flag?Set_Dat[Input_Index+3*Alarm_Dat_Index] % 16:10;    
 281   2        }
 282   1      }
 283          
 284          
 285          /* å…¶ä»–æ˜¾ç¤ºå‡½æ•° */
 286          void Led_Proc()
 287          {
C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 6   

 288   1        unsigned char i;//Forå¾ªç¯ä¸“ç”¨å˜é‡
 289   1        for(i=1;i<4;i++)//å¸¸ç”¨äº’æ–¥ç‚¹äº®æ€è·¯ åˆ©ç”¨ä½è¿ç®—ç¬¦ æ¡ä»¶æ»¡è¶³æ—¶é»˜è®¤è¿”å›1
 290   1          ucLed[i] = (i == Alarm_Dat_Index + 1) * (Seg_Disp_Mode == 1 || Seg_Disp_Mode == 4);//å¤„äºæ—¶é’Ÿç•Œé¢æ
             -—¶ ç‚¹äº®ç›¸åº”çš„LedæŒ‡ç¤ºç¯
 291   1      //  if(ucAlarm[0] == ucRtc[0] && ucAlarm[1] == ucRtc[1] && ucAlarm[2] == ucRtc[2])
 292   1      //    Beep_Flag = 1;
 293   1      //  if(ucAlarm[3] == ucRtc[0] && ucAlarm[4] == ucRtc[1] && ucAlarm[5] == ucRtc[2])
 294   1      //    Beep_Flag = 1;
 295   1      //  if(ucAlarm[6] == ucRtc[0] && ucAlarm[7] == ucRtc[1] && ucAlarm[8] == ucRtc[2])
 296   1      //    Beep_Flag = 1;
 297   1        for(i=0;i<3;i++)//ä½¿ç”¨å¾ªç¯ç®€åŒ–ä»£ç  å½“æ£€æµ‹åˆ°ä¸€ä¸ªé—¹é’Ÿä½¿èƒ½æ—¶ ç›´æ¥é€€å‡ºå¾ªç¯ å‡å°‘è¿
             -è¡Œèµ„æºå ç”¨
 298   1        {
 299   2          if(ucAlarm[0+i*3] == ucRtc[0] && ucAlarm[1+i*3] == ucRtc[1] && ucAlarm[2+i*3] == ucRtc[2])
 300   2          {
 301   3            Beep_Flag = 1;
 302   3            Beep_Index = i;//è®°å½•é—¹é’Ÿç¼–å·
 303   3            break;
 304   3          }
 305   2        }
 306   1        if(Beep_Flag == 1)//é—¹é’Ÿå¤„äºä½¿èƒ½çŠ¶æ€
 307   1        {
 308   2          if((ucRtc[2] % 16) ==  ((ucAlarm[2+Beep_Index*3] % 16) + 5) % 10)//è®°å½•äº”ç§’
 309   2            Beep_Flag = 0;//å…³é—­é—¹é’Ÿ
 310   2        }
 311   1        ucLed[0] = Led_Star_Flag?(Beep_Flag&Beep_Enable_Flag):0;
 312   1        ucLed[7] = !(ucAlarm[3*Alarm_Dat_Index] / 0x24) * (Seg_Disp_Mode == 1 || Seg_Disp_Mode == 4);;//è‹¥æ—¶é’Ÿ
             -å€¼æ¯”23å¤§ åˆ™è¡¨ç¤ºæœªå¯ç”¨
 313   1      }
 314          
 315          /* å®šæ—¶å™¨0ä¸­æ–­åˆå§‹åŒ–å‡½æ•° */
 316          void Timer0Init(void)   //1æ¯«ç§’@12.000MHz
 317          {
 318   1        AUXR &= 0x7F;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 319   1        TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 320   1        TL0 = 0x18;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 321   1        TH0 = 0xFC;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 322   1        TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
 323   1        TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 324   1        ET0 = 1;    //å®šæ—¶å™¨ä¸­æ–­0æ‰“å¼€
 325   1        EA = 1;     //æ€»ä¸­æ–­æ‰“å¼€
 326   1      }
 327          
 328          /* å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•° */
 329          void Timer0Server() interrupt 1
 330          {  
 331   1        if(++Key_Slow_Down == 10) Key_Slow_Down = 0;//é”®ç›˜å‡é€Ÿä¸“ç”¨
 332   1        if(++Seg_Slow_Down == 100) Seg_Slow_Down = 0;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨
 333   1        if(++Seg_Pos == 8) Seg_Pos = 0;//æ•°ç ç®¡æ˜¾ç¤ºä¸“ç”¨
 334   1        Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
 335   1        Led_Disp(Seg_Pos,ucLed[Seg_Pos]);
 336   1        if(++Timer_500Ms == 500)
 337   1        {
 338   2          Timer_500Ms = 0;//è®¡æ—¶å€¼å¤ä½
 339   2          Seg_Star_Flag ^= 1;//æ ‡å¿—ä½å–å
 340   2        }
 341   1        if(++Timer_200Ms == 200)
 342   1        {
 343   2          Timer_200Ms = 0;
 344   2          Led_Star_Flag ^= 1;
 345   2        }
 346   1      }
C51 COMPILER V9.54   MAIN                                                                  03/28/2023 23:26:51 PAGE 7   

 347          
 348          /* Main */
 349          void main()
 350          {
 351   1        System_Init();
 352   1        Timer0Init();
 353   1        Set_Rtc(ucRtc);//è®¾ç½®ä¸Šç”µåˆå§‹åŒ–æ—¶é—´
 354   1        Set_Date(ucDate);//è®¾ç½®ä¸Šç”µåˆå§‹åŒ–æ—¥æœŸ
 355   1        while (1)
 356   1        {
 357   2          Key_Proc();
 358   2          Seg_Proc();
 359   2          Led_Proc();
 360   2        }
 361   1      }
*** WARNING C291 IN LINE 71 OF main.c: not every exit path returns a value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1443    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     72       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
