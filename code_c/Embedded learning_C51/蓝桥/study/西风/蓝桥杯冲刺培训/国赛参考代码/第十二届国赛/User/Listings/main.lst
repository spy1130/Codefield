C51 COMPILER V9.54   MAIN                                                                  05/20/2023 12:04:51 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /* å¤´æ–‡ä»¶å£°æ˜åŒº */
   2          #include <STC15F2K60S2.H>//å•ç‰‡æœºå¯„å­˜å™¨ä¸“ç”¨å¤´æ–‡ä»¶
   3          #include <Init.h>//åˆå§‹åŒ–åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   4          #include <Led.h>//Ledåº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   5          #include <Key.h>//æŒ‰é”®åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   6          #include <Seg.h>//æ•°ç ç®¡åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   7          #include "ds1302.h"//æ—¶é’Ÿåº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   8          
   9          /* å˜é‡å£°æ˜åŒº */
  10          unsigned char Key_Val,Key_Down,Key_Old,Key_Up;//æŒ‰é”®ä¸“ç”¨å˜é‡
  11          unsigned char Key_Slow_Down;//æŒ‰é”®å‡é€Ÿä¸“ç”¨å˜é‡
  12          unsigned char Seg_Buf[8] = {10,10,10,10,10,10,10,10};//æ•°ç ç®¡æ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  13          unsigned char Seg_Point[8] = {0,0,0,0,0,0,0,0};//æ•°ç ç®¡å°æ•°ç‚¹æ•°æ®å­˜æ”¾æ•°ç»„
  14          unsigned char Seg_Pos;//æ•°ç ç®¡æ‰«æä¸“ç”¨å˜é‡
  15          unsigned int Seg_Slow_Down;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨å˜é‡
  16          unsigned char Read_Index = 1;//ä¿¡æ¯è¯»å–æ ‡å¿—  0-ç©ºé—²çŠ¶æ€ 1-è¯»å–æ—¶é’Ÿ ä¸Šç”µé»˜è®¤ç«‹åˆ»è¯»å–ä
             -¸€æ¬¡æ—¶é’Ÿæ•°æ®
  17          unsigned char ucLed[8] = {0,0,0,0,0,0,0,0};//Ledæ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  18          unsigned char Seg_Disp_Mode;//æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼å˜é‡ 0-æ—¶é’Ÿæ˜¾ç¤º 1-è·ç¦»æ˜¾ç¤º 2-æ•°æ®è®°å½• 3-å
             -‚æ•°è®¾ç½®
  19          unsigned char ucRtc[3] = {20,20,01};//æ—¶é’Ÿæ•°æ®å­˜æ”¾æ•°ç»„
  20          
  21          /* é”®ç›˜å¤„ç†å‡½æ•° */
  22          void Key_Proc()
  23          {
  24   1        if(Key_Slow_Down) return;
  25   1        Key_Slow_Down = 1;//é”®ç›˜å‡é€Ÿç¨‹åº
  26   1      
  27   1        Key_Val = Key_Read();//å®æ—¶è¯»å–é”®ç å€¼
  28   1        Key_Down = Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸‹é™æ²¿
  29   1        Key_Up = ~Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸Šé™æ²¿
  30   1        Key_Old = Key_Val;//è¾…åŠ©æ‰«æå˜é‡
  31   1      
  32   1      }
  33          
  34          /* ä¿¡æ¯å¤„ç†å‡½æ•° */
  35          void Seg_Proc()
  36          {
  37   1        /* æ•°æ®è¯»å–åŒºåŸŸ */
  38   1        switch(Read_Index)
  39   1        {
  40   2          case 1:Read_Rtc(ucRtc);break;//å®æ—¶è¯»å–æ—¶é’Ÿæ•°æ®
  41   2        }
  42   1        Read_Index = 0;//è¯»å–å®Œååˆ‡æ¢åˆ°ç©ºé—²çŠ¶æ€
  43   1      
  44   1        /* ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ */
  45   1        switch(Seg_Disp_Mode)
  46   1        {
  47   2          case 0://æ—¶é’Ÿæ˜¾ç¤ºç•Œé¢
  48   2            Seg_Buf[0] = ucRtc[0] / 10;
  49   2            Seg_Buf[1] = ucRtc[0] % 10;
  50   2            Seg_Buf[2] = 11;
  51   2            Seg_Buf[3] = ucRtc[1] / 10;
  52   2            Seg_Buf[4] = ucRtc[1] % 10;
C51 COMPILER V9.54   MAIN                                                                  05/20/2023 12:04:51 PAGE 2   

  53   2            Seg_Buf[5] = 11;
  54   2            Seg_Buf[6] = ucRtc[2] / 10;
  55   2            Seg_Buf[7] = ucRtc[2] % 10;     
  56   2          break;
  57   2        }
  58   1      }
  59          
  60          /* å…¶ä»–æ˜¾ç¤ºå‡½æ•° */
  61          void Led_Proc()
  62          {
  63   1        
  64   1      }
  65          
  66          /* å®šæ—¶å™¨0ä¸­æ–­åˆå§‹åŒ–å‡½æ•° */
  67          void Timer0Init(void)   //1æ¯«ç§’@12.000MHz
  68          {
  69   1        AUXR &= 0x7F;   //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  70   1        TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  71   1        TL0 = 0x18;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  72   1        TH0 = 0xFC;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  73   1        TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
  74   1        TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
  75   1        ET0 = 1;    //å®šæ—¶å™¨ä¸­æ–­0æ‰“å¼€
  76   1        EA = 1;     //æ€»ä¸­æ–­æ‰“å¼€
  77   1      }
  78          
  79          /* å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•° */
  80          void Timer0Server() interrupt 1
  81          {  
  82   1        if(++Key_Slow_Down == 10) Key_Slow_Down = 0;//é”®ç›˜å‡é€Ÿä¸“ç”¨
  83   1        if(++Seg_Slow_Down == 500) Seg_Slow_Down = 0;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨
  84   1        switch(Seg_Slow_Down)//ä¿¡æ¯è½®è¯¢ä¸“ç”¨
  85   1        {
  86   2          case 100:Read_Index = 1;break;
  87   2        }
  88   1        if(++Seg_Pos == 8) Seg_Pos = 0;//æ•°ç ç®¡æ˜¾ç¤ºä¸“ç”¨
  89   1        Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
  90   1        Led_Disp(Seg_Pos,ucLed[Seg_Pos]);
  91   1      }
  92          
  93          
  94          /* Main */
  95          void main()
  96          {
  97   1        System_Init();//ç³»ç»Ÿåˆå§‹åŒ–
  98   1        Set_Rtc(ucRtc);//è®¾ç½®æ—¶é’Ÿæ•°æ®
  99   1        Timer0Init();
 100   1        while (1)
 101   1        {
 102   2          Key_Proc();
 103   2          Seg_Proc();
 104   2          Led_Proc();
 105   2        }
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    307    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     37    ----
C51 COMPILER V9.54   MAIN                                                                  05/20/2023 12:04:51 PAGE 3   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
