C51 COMPILER V9.54   MAIN                                                                  12/01/2022 16:20:11 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /* å¤´æ–‡ä»¶å£°æ˜åŒº */
   2          #include <REGX52.H>//å•ç‰‡æœºå¯„å­˜å™¨ä¸“ç”¨å¤´æ–‡ä»¶
   3          #include <Key.h>//æŒ‰é”®åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   4          #include <Seg.h>//æ•°ç ç®¡åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   5          #include <Led.h>//Ledåº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   6          
   7          /* å˜é‡å£°æ˜åŒº */
   8          unsigned char Key_Val,Key_Down,Key_Old,Key_Up;//æŒ‰é”®ä¸“ç”¨å˜é‡
   9          unsigned char Key_Slow_Down;//æŒ‰é”®å‡é€Ÿä¸“ç”¨å˜é‡
  10          unsigned char Seg_Buf[6] = {10,10,10,10,10,10};//æ•°ç ç®¡æ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  11          unsigned char Seg_Pos;//æ•°ç ç®¡æ‰«æä¸“ç”¨å˜é‡
  12          unsigned char Seg_Point[6] = {0,0,0,0,0,0};//æ•°ç ç®¡å°æ•°ç‚¹å­˜æ”¾æ•°ç»„
  13          unsigned int Seg_Slow_Down;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨å˜é‡
  14          unsigned char Led_Pos;//Ledæ‰«æä¸“ç”¨å˜é‡
  15          unsigned char ucLed[8] = {0,0,0,0,0,0,0,0};//Ledæ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  16          unsigned char Seg_Disp_Mode;//æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼ 0-æ¸©åº¦é‡‡é›†ç•Œé¢ 1-æ•°æ®æ˜¾ç¤ºç•Œé¢ 2-å‚æ•°è®¾ç
             -½®ç•Œé¢
  17          unsigned char Seg_Input[3] = {11,11,11};//æ•°ç ç®¡è¾“å…¥æ•°æ®å­˜æ”¾æ•°ç»„
  18          unsigned char Seg_Input_Index;//æ•°ç ç®¡è¾“å…¥æ•°ç»„æŒ‡é’ˆ
  19          unsigned int Timer_500Ms;//äº”ç™¾æ¯«ç§’è®¡æ—¶å˜é‡
  20          unsigned char Point_Wela;//å°æ•°ç‚¹è¾“å…¥ä½æ•°è®°å½•å˜é‡
  21          unsigned char Parameter[2] = {30,20};//å‚æ•°è®¾ç½®æ•°ç»„
  22          unsigned char Parameter_Ctrol[2] = {30,20};//å®é™…å‚æ•°æ§åˆ¶æ•°ç»„
  23          unsigned int Count_500Ms;//äº”ç™¾æ¯«ç§’è®¡æ•°å˜é‡
  24          unsigned char Led_Num;//Ledäº®åº¦ç­‰çº§è®¡æ•°å˜é‡
  25          unsigned char Led_Pwm;//Ledäº®åº¦ç­‰çº§
  26          float Temperature;//å®é™…æ¸©åº¦å˜é‡
  27          bit Seg_Star_Flag;//æ•°ç ç®¡é—ªçƒæ ‡å¿—ä½
  28          bit Point_Flag;//å°æ•°ç‚¹ä½¿èƒ½æ ‡å¿—ä½
  29          bit Parameter_Index;//å‚æ•°è®¾ç½®æ•°ç»„æŒ‡é’ˆ
  30          bit Time_Flag;//è®¡æ—¶å¯åŠ¨æ ‡å¿—ä½
  31          bit Error_Flag;//é”™è¯¯æ•°æ®æ ‡å¿—ä½
  32          
  33          /* é”®ç›˜å¤„ç†å‡½æ•° */
  34          void Key_Proc()
  35          {
  36   1        unsigned char i;//Forå¾ªç¯ä¸“ç”¨å˜é‡
  37   1        if(Key_Slow_Down) return;
  38   1        Key_Slow_Down = 1;//é”®ç›˜å‡é€Ÿç¨‹åº
  39   1      
  40   1        Key_Val = Key_Read();//å®æ—¶è¯»å–é”®ç å€¼
  41   1        Key_Down = Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸‹é™æ²¿
  42   1        Key_Up = ~Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸Šå‡æ²¿
  43   1        Key_Old = Key_Val;//è¾…åŠ©æ‰«æå˜é‡
  44   1        
  45   1        if(Key_Down >= 1 && Key_Down <= 10 && Seg_Input_Index <= 2)//çŸ©é˜µè¾“å…¥é”®ç›˜ä½¿èƒ½
  46   1        {
  47   2          Seg_Input[Seg_Input_Index] = Key_Down - 1;//å°†è¾“å…¥æ•°å€¼ç»™è¾“å…¥æ•°ç»„
  48   2          Seg_Input_Index++;//æ•°ç»„æŒ‡é’ˆåŠ ä¸€
  49   2        }
  50   1        
  51   1        if(Seg_Disp_Mode == 2)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
  52   1        {
  53   2          if(Key_Down == 14)//S14æŒ‰ä¸‹
C51 COMPILER V9.54   MAIN                                                                  12/01/2022 16:20:11 PAGE 2   

  54   2            Time_Flag = 1;//è®¡æ—¶å¼€å§‹
  55   2        }
  56   1        if(Count_500Ms < 500)//çŸ­æŒ‰
  57   1        {
  58   2          if(Key_Up == 14)//S14æŠ¬èµ·
  59   2          {
  60   3            Time_Flag = Count_500Ms = 0;//çŠ¶æ€å¤ä½
  61   3            if(++Parameter[Parameter_Index] > 70)//è¶…è¿‡ä¸Šé™å€¼
  62   3              Parameter[Parameter_Index] = 10;
  63   3          }
  64   2        }
  65   1        else//é•¿æŒ‰
  66   1        {
  67   2          if(Key_Old == 14)//S14é•¿æŒ‰
  68   2          {
  69   3            if(++Parameter[Parameter_Index] > 70)//è¶…è¿‡ä¸Šé™å€¼
  70   3              Parameter[Parameter_Index] = 10;
  71   3          }
  72   2          if(Key_Up == 14)//S14æŠ¬èµ·
  73   2            Time_Flag = Count_500Ms = 0;//çŠ¶æ€å¤ä½
  74   2        }
  75   1        
  76   1        
  77   1        if(Seg_Disp_Mode == 2)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
  78   1        {
  79   2          if(Key_Down == 15)//S15æŒ‰ä¸‹
  80   2            Time_Flag = 1;//è®¡æ—¶å¼€å§‹
  81   2        }
  82   1        if(Count_500Ms < 500)//çŸ­æŒ‰
  83   1        {
  84   2          if(Key_Up == 15)//S15æŠ¬èµ·
  85   2          {
  86   3            Time_Flag = Count_500Ms = 0;//çŠ¶æ€å¤ä½
  87   3            if(--Parameter[Parameter_Index] == 255)//è¶…è¿‡ä¸‹é™å€¼
  88   3              Parameter[Parameter_Index] = 70;
  89   3          }
  90   2        }
  91   1        else//é•¿æŒ‰
  92   1        {
  93   2          if(Key_Old == 15)//S15é•¿æŒ‰
  94   2          {
  95   3            if(--Parameter[Parameter_Index] == 255)//è¶…è¿‡ä¸‹é™å€¼
  96   3              Parameter[Parameter_Index] = 70;
  97   3          }
  98   2          if(Key_Up == 15)//S15æŠ¬èµ·
  99   2            Time_Flag = Count_500Ms = 0;//çŠ¶æ€å¤ä½
 100   2        }
 101   1        
 102   1        switch(Key_Down)
 103   1        {
 104   2          case 11://å°æ•°ç‚¹è¾“å…¥
 105   2            if(Seg_Disp_Mode == 0 && Point_Flag == 0 && Seg_Input[0] != 11)//å¤„äºæ¸©åº¦é‡‡é›†ç•Œé¢ã€æ ‡å¿—ä½ä¸
             -º0ã€è¾“å…¥æ•°ç»„ç¬¬ä¸€ä½æœ‰æ•°æ®
 106   2            {
 107   3              Seg_Point[2+Seg_Input_Index] = 1;
 108   3              Point_Wela = Seg_Input_Index;//è®°å½•æ­¤æ—¶æŒ‡é’ˆçŠ¶æ€ ä¾¿äºåæœŸæ•°æ®å¤„ç†
 109   3              Point_Flag = 1;//æ‹‰é«˜æ ‡å¿—ä½ ä¿è¯ä¸€æ¬¡è¾“å…¥å‘¨æœŸå°æ•°ç‚¹åªèƒ½ä½¿èƒ½ä¸€æ¬¡
 110   3            }
 111   2          break;
 112   2          case 16://æ¸©åº¦é‡‡é›†
 113   2            if(Seg_Disp_Mode != 0)//å¤„äºéæ¸©åº¦é‡‡é›†ç•Œé¢
 114   2            {
C51 COMPILER V9.54   MAIN                                                                  12/01/2022 16:20:11 PAGE 3   

 115   3              Seg_Input_Index = 0;//æŒ‡é’ˆå¤ä½
 116   3              Point_Flag = 0;//å°æ•°ç‚¹è¾“å…¥æ ‡å¿—ä½å¤ä½
 117   3              for(i = 0;i < 3;i++)//æ•°ç»„å¤ä½
 118   3                Seg_Input[i] = 11;
 119   3              Seg_Disp_Mode = 0;
 120   3            }
 121   2            else//å¤„äºæ¸©åº¦é‡‡é›†ç•Œé¢
 122   2            {
 123   3              if(Point_Flag == 0 || Seg_Input_Index < 3)//è‹¥å°æ•°ç‚¹æ²¡æœ‰ä½¿èƒ½ æˆ–è€…æŒ‡é’ˆä¸ä¸º3 åˆ™ä¸€å®šä¸ºæ
             -— æ•ˆæ•°æ®
 124   3              {
 125   4                Seg_Input_Index = 0;//æŒ‡é’ˆå¤ä½
 126   4                Seg_Point[3] = Seg_Point[4] = 0;//å°æ•°ç‚¹å¤ä½
 127   4                Point_Flag = 0;//å°æ•°ç‚¹è¾“å…¥æ ‡å¿—ä½å¤ä½
 128   4                for(i = 0;i < 3;i++)//æ•°ç»„å¤ä½
 129   4                  Seg_Input[i] = 11;
 130   4              }
 131   3              else//å°æ•°ç‚¹ä½¿èƒ½ è¿›è¡ŒèŒƒå›´åˆ¤æ–­
 132   3              {
 133   4                Temperature = Seg_Input[0] * 100 + Seg_Input[1] * 10 + Seg_Input[2] + 5;
 134   4                while(3 - Point_Wela)
 135   4                {
 136   5                  Temperature /= 10.0;
 137   5                  Point_Wela++;
 138   5                }
 139   4                if((unsigned char)Temperature > 85)//è¶…å‡ºé‡‡é›†ä¸Šé™å€¼
 140   4                {
 141   5                  Seg_Input_Index = 0;//æŒ‡é’ˆå¤ä½
 142   5                  Seg_Point[3] = Seg_Point[4] = 0;//å°æ•°ç‚¹å¤ä½
 143   5                  Point_Flag = 0;//å°æ•°ç‚¹è¾“å…¥æ ‡å¿—ä½å¤ä½
 144   5                  for(i = 0;i < 3;i++)//æ•°ç»„å¤ä½
 145   5                    Seg_Input[i] = 11;            
 146   5                }
 147   4                else//æ•°æ®åˆç†
 148   4                {
 149   5                  Seg_Input_Index = 0;//æŒ‡é’ˆå¤ä½
 150   5                  Seg_Point[3] = Seg_Point[4] = 0;//å°æ•°ç‚¹å¤ä½
 151   5                  Point_Flag = 0;//å°æ•°ç‚¹è¾“å…¥æ ‡å¿—ä½å¤ä½
 152   5                  Seg_Disp_Mode = 1;//è·³è½¬åˆ°æ•°æ®æ˜¾ç¤ºç•Œé¢
 153   5                }
 154   4              }
 155   3            }
 156   2          break;
 157   2          case 12://ç•Œé¢åˆ‡æ¢
 158   2            if(Seg_Disp_Mode != 0)//å¤„äºéæ¸©åº¦é‡‡é›†ç•Œé¢
 159   2              Seg_Disp_Mode = Seg_Disp_Mode==1?2:1;
 160   2            if(Seg_Disp_Mode == 2)//åˆ‡æ¢åˆ°å‚æ•°è®¾ç½®ç•Œé¢æ—¶
 161   2            {
 162   3              Parameter_Index = 0;//æŒ‡é’ˆå¤ä½
 163   3              Parameter[0] = Parameter_Ctrol[0];//æ•°æ®å¤ä½
 164   3              Parameter[1] = Parameter_Ctrol[1];
 165   3            }
 166   2            else//åˆ‡æ¢åˆ°æ•°æ®æ˜¾ç¤ºç•Œé¢
 167   2            {
 168   3              if(Parameter[0] >= Parameter[1] && Parameter[0] <= 70 && Parameter[1] >= 10)//åˆç†è®¾ç½®å‚æ•°
 169   3              {
 170   4                Error_Flag = 0;
 171   4                Parameter_Ctrol[0] = Parameter[0];//è®¾ç½®ç”Ÿæ•ˆ
 172   4                Parameter_Ctrol[1] = Parameter[1];
 173   4              }
 174   3              else
 175   3                Error_Flag = 1;
C51 COMPILER V9.54   MAIN                                                                  12/01/2022 16:20:11 PAGE 4   

 176   3            }
 177   2          break;
 178   2          case 13://å‚æ•°åˆ‡æ¢
 179   2            if(Seg_Disp_Mode == 2)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
 180   2              Parameter_Index ^= 1;//æŒ‡é’ˆå–å
 181   2          break;
 182   2      //    case 14://å‚æ•°+1
 183   2      //      if(Seg_Disp_Mode == 2)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
 184   2      //      {
 185   2      //        if(++Parameter[Parameter_Index] > 70)//è¶…è¿‡ä¸Šé™å€¼
 186   2      //          Parameter[Parameter_Index] = 10;
 187   2      //      }
 188   2      //    break;
 189   2      //    case 15://å‚æ•°-1
 190   2      //      if(Seg_Disp_Mode == 2)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
 191   2      //      {
 192   2      //        if(--Parameter[Parameter_Index] == 255)//è¶…è¿‡ä¸‹é™å€¼
 193   2      //          Parameter[Parameter_Index] = 70;
 194   2      //      }     
 195   2      //    break;
 196   2        }
 197   1      }
 198          
 199          /* ä¿¡æ¯å¤„ç†å‡½æ•° */
 200          void Seg_Proc()
 201          {
 202   1        unsigned char i;//Forå¾ªç¯ä¸“ç”¨å˜é‡
 203   1        if(Seg_Slow_Down) return;
 204   1        Seg_Slow_Down = 1;//æ•°ç ç®¡å‡é€Ÿç¨‹åº
 205   1      
 206   1        switch(Seg_Disp_Mode)
 207   1        {
 208   2          case 0://æ¸©åº¦é‡‡é›†ç•Œé¢
 209   2            Seg_Buf[0] = 12;//A
 210   2            Seg_Buf[1] = Seg_Buf[2] = 10;//ç†„ç­
 211   2            for(i = 0;i < 3;i++)//è¾“å…¥æ•°æ®
 212   2              Seg_Buf[3+i] = Seg_Input[i];
 213   2            if(Seg_Input[2] == 11)//å½“æœ€åä¸€ä½æ•°ç ç®¡æœªè¾“å…¥æ•°æ®æ—¶
 214   2              Seg_Buf[3+Seg_Input_Index] = Seg_Star_Flag?Seg_Input[Seg_Input_Index]:10;//å½“å‰è¾“å…¥æ•°ç ç®¡é—ªçƒ
 215   2          break;
 216   2          case 1://æ•°æ®æ˜¾ç¤ºç•Œé¢
 217   2            Seg_Buf[0] = 13;//C
 218   2            for(i = 0;i < 3;i++)//ç†„ç­
 219   2              Seg_Buf[1+i] = 10;
 220   2            Seg_Buf[4] = (unsigned char)Temperature / 10;
 221   2            Seg_Buf[5] = (unsigned char)Temperature % 10;
 222   2          break;
 223   2          case 2://å‚æ•°è®¾ç½®ç•Œé¢
 224   2            Seg_Buf[0] = 14;//P
 225   2            Seg_Buf[1] = 10;//ç†„ç­
 226   2            Seg_Buf[2] = Parameter[0] / 10;
 227   2            Seg_Buf[3] = Parameter[0] % 10;
 228   2            Seg_Buf[4] = Parameter[1] / 10;
 229   2            Seg_Buf[5] = Parameter[1] % 10;
 230   2            Seg_Buf[2+2*Parameter_Index] = Seg_Star_Flag?Parameter[Parameter_Index] / 10:10;//å½“å‰é€‰ä¸­æ•°ç ç®¡
             -é—ªçƒ
 231   2            Seg_Buf[3+2*Parameter_Index] = Seg_Star_Flag?Parameter[Parameter_Index] % 10:10;
 232   2          break;
 233   2        }
 234   1      }
 235          
 236          /* å…¶ä»–æ˜¾ç¤ºå‡½æ•° */
C51 COMPILER V9.54   MAIN                                                                  12/01/2022 16:20:11 PAGE 5   

 237          void Led_Proc()
 238          {
 239   1      //  Led_Pwm = 3 * (1 * ((int)Temperature / Parameter_Ctrol[0]) + 2 * ((!((int)Temperature / Parameter_Ctrol
             -[0])) & ((int)Temperature / Parameter_Ctrol[1])) + 3 *(!((int)Temperature / Parameter_Ctrol[1])));
 240   1        if(Temperature > Parameter_Ctrol[0])
 241   1          Led_Pwm = 3;
 242   1        else if(Temperature < Parameter_Ctrol[0] && Temperature > Parameter_Ctrol[1])
 243   1          Led_Pwm = 6;
 244   1        else
 245   1          Led_Pwm = 9;
 246   1        ucLed[0] = (int)Temperature / Parameter_Ctrol[0];
 247   1        ucLed[1] = (!((int)Temperature / Parameter_Ctrol[0])) & ((int)Temperature / Parameter_Ctrol[1]);
 248   1        ucLed[2] = !((int)Temperature / Parameter_Ctrol[1]);
 249   1        ucLed[3] = Error_Flag;
 250   1      }
 251          
 252          /* å®šæ—¶å™¨0ä¸­æ–­åˆå§‹åŒ–å‡½æ•° */
 253          void Timer0Init(void)   //1æ¯«ç§’@12.000MHz
 254          {
 255   1        TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 256   1        TMOD |= 0x01;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 257   1        TL0 = 0x18;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 258   1        TH0 = 0xFC;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 259   1        TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
 260   1        TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 261   1        ET0 = 1;        //å®šæ—¶å™¨0ä¸­æ–­æ‰“å¼€
 262   1        EA = 1;         //æ€»ä¸­æ–­æ‰“å¼€
 263   1      }
 264          
 265          /* å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•° */
 266          void Timer0Server() interrupt 1
 267          {
 268   1        TL0 = 0x18;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 269   1        TH0 = 0xFC;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼   
 270   1        if(++Key_Slow_Down == 10) Key_Slow_Down = 0;//é”®ç›˜å‡é€Ÿä¸“ç”¨
 271   1        if(++Seg_Slow_Down == 10) Seg_Slow_Down = 0;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨
 272   1        if(++Seg_Pos == 6) Seg_Pos = 0;//æ•°ç ç®¡æ˜¾ç¤ºä¸“ç”¨
 273   1        if(++Led_Pos == 8) Led_Pos = 0;//Ledæ˜¾ç¤ºä¸“ç”¨
 274   1        Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
 275   1        if(++Timer_500Ms == 500)//æ¯äº”ç™¾æ¯«ç§’è§¦å‘ä¸€æ¬¡
 276   1        {
 277   2          Timer_500Ms = 0;//è®¡æ•°å€¼å¤ä½ ä¾¿äºä¸‹æ¬¡ä½¿ç”¨
 278   2          Seg_Star_Flag ^= 1;//é—ªçƒæ ‡å¿—ä½å–å
 279   2        }
 280   1        if(Time_Flag == 1)
 281   1        {
 282   2          if(++Count_500Ms == 600)//è‡ªåŠ åˆ°äº”ç™¾æ¯«ç§’ä»¥ä¸Šå°±å¯ä»¥é™åˆ¶ä½ é˜²æ­¢ä¸€ç›´æŒ‰ä¸‹è‡ªåŠ çš„æ—¶å€
             -™æ•°å€¼è¶Šç•Œ
 283   2            Count_500Ms = 600;
 284   2        }
 285   1        if(++Led_Num == 10) Led_Num = 0;
 286   1        if(Led_Num < Led_Pwm)
 287   1          Led_Disp(Led_Pos,ucLed[Led_Pos]);
 288   1        else
 289   1          Led_Disp(Led_Pos,0);
 290   1      }
 291          
 292          /* Main */
 293          void main()
 294          {
 295   1        Timer0Init();
 296   1        while (1)
C51 COMPILER V9.54   MAIN                                                                  12/01/2022 16:20:11 PAGE 6   

 297   1        {
 298   2          Key_Proc();
 299   2          Seg_Proc();
 300   2          Led_Proc();
 301   2        }
 302   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1271    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     49       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      5    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
