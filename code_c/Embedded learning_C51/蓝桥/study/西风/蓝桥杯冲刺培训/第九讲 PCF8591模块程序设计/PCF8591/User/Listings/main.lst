C51 COMPILER V9.60.7.0   MAIN                                                              04/01/2024 22:20:07 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Applications\Keil_5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /* å¤´æ–‡ä»¶å£°æ˜åŒº */
   2          #include <STC15F2K60S2.H>//å•ç‰‡æœºå¯„å­˜å™¨ä¸“ç”¨å¤´æ–‡ä»¶
   3          #include <Init.h>//åˆå§‹åŒ–åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   4          #include <Led.h>//Ledåº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   5          #include <Key.h>//æŒ‰é”®åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   6          #include <Seg.h>//æ•°ç ç®¡åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   7          #include <iic.h>//æ•°æ¨¡è½¬æ¢åº•å±‚é©±åŠ¨ä¸“å±å¤´æ–‡ä»¶
   8          
   9          /* å˜é‡å£°æ˜åŒº */
  10          unsigned char Key_Val,Key_Down,Key_Old,Key_Up;//æŒ‰é”®ä¸“ç”¨å˜é‡
  11          unsigned char Key_Slow_Down;//æŒ‰é”®å‡é€Ÿä¸“ç”¨å˜é‡
  12          unsigned char Seg_Buf[8] = {10,10,10,10,10,10,10,10};//æ•°ç ç®¡æ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  13          unsigned char Seg_Point[8] = {0,0,0,0,0,0,0,0};//æ•°ç ç®¡å°æ•°ç‚¹æ•°æ®å­˜æ”¾æ•°ç»„
  14          unsigned char Seg_Pos;//æ•°ç ç®¡æ‰«æä¸“ç”¨å˜é‡
  15          unsigned int Seg_Slow_Down;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨å˜é‡
  16          unsigned char ucLed[8] = {0,0,0,0,0,0,0,0};//Ledæ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  17          bit Seg_Disp_Mode;//æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼å˜é‡ 0-ç”µå‹æ˜¾ç¤ºç•Œé¢ 1-ç”µå‹è¾“å‡ºç•Œé¢
  18          bit Output_Mode;//ç”µå‹è¾“å‡ºæ¨¡å¼å˜é‡ 0-å›ºå®š2V 1-éšè¯»å–å€¼å˜åŒ–
  19          bit Led_Enable_Flag = 1;//Ledä½¿èƒ½æ ‡å¿—ä½ 0-ä¸ä½¿èƒ½ 1-ä½¿èƒ½
  20          bit Seg_Enable_Flag = 1;//æ•°ç ç®¡ä½¿èƒ½æ ‡å¿—ä½ 0-ä¸ä½¿èƒ½ 1-ä½¿èƒ½
  21          float Voltage_Output;//å®æ—¶è¾“å‡ºç”µå‹å€¼
  22          float Voltage;//å®æ—¶è¯»å–ç”µå‹å€¼
  23          
  24          /* é”®ç›˜å¤„ç†å‡½æ•° */
  25          void Key_Proc()
  26          {
  27   1              if(Key_Slow_Down) return;
  28   1              Key_Slow_Down = 1;//é”®ç›˜å‡é€Ÿç¨‹åº
  29   1      
  30   1              Key_Val = Key_Read();//å®æ—¶è¯»å–é”®ç å€¼
  31   1              Key_Down = Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸‹é™æ²¿
  32   1              Key_Up = ~Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸Šé™æ²¿
  33   1              Key_Old = Key_Val;//è¾…åŠ©æ‰«æå˜é‡
  34   1              
  35   1              switch(Key_Down)
  36   1              {
  37   2                      case 4://ç•Œé¢åˆ‡æ¢æŒ‰é”®
  38   2                              Seg_Disp_Mode ^= 1;
  39   2                      break;
  40   2                      case 5://è¾“å‡ºæ¨¡å¼åˆ‡æ¢æŒ‰é”®
  41   2                              Output_Mode ^= 1;
  42   2                      break;
  43   2                      case 6://LedæŒ‡ç¤ºç¯åŠŸèƒ½æ§åˆ¶æŒ‰é”®
  44   2                              Led_Enable_Flag ^= 1;
  45   2                      break;
  46   2                      case 7://æ•°ç ç®¡æ˜¾ç¤ºåŠŸèƒ½æ§åˆ¶æŒ‰é”®
  47   2                              Seg_Enable_Flag ^= 1;
  48   2                      break;
  49   2              }
  50   1      }
  51          
  52          /* ä¿¡æ¯å¤„ç†å‡½æ•° */
  53          void Seg_Proc()
  54          {
C51 COMPILER V9.60.7.0   MAIN                                                              04/01/2024 22:20:07 PAGE 2   

  55   1              unsigned char i;//ç”¨äºForå¾ªç¯
  56   1              if(Seg_Slow_Down) return;
  57   1              Seg_Slow_Down = 1;//æ•°ç ç®¡å‡é€Ÿç¨‹åº
  58   1      
  59   1              /* æ•°æ®è¯»å–åŒºåŸŸ */
  60   1              Voltage = AD_Read(0x43) / 51.0;//å‰é¢è·å–çš„åªæ˜¯ä¸€ä¸ª0~255çš„æ•°æ®ï¼Œæ¨¡æ‹Ÿè¾“å‡ºå°±æ˜¯ä»¥5Vä¸ºå
             -‚è€ƒç”µå‹,å…¬å¼ä¸ºæ¨¡æ‹Ÿé‡=æ•°å­—é‡*5/255è¯»å–å®æ—¶ç”µå‹å€¼
  61   1              if(Output_Mode == 0)//å›ºå®šè¾“å‡º2V
  62   1                      Voltage_Output = 2;
  63   1              else
  64   1                      Voltage_Output = Voltage;
  65   1              
  66   1              /* ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ */
  67   1              Seg_Point[5] = 1;//ä½¿èƒ½ç¬¬å…­ä½æ•°ç ç®¡å°æ•°ç‚¹
  68   1              if(Seg_Disp_Mode == 0)//å¤„äºç”µå‹æ˜¾ç¤ºç•Œé¢
  69   1              {
  70   2                      Seg_Buf[0] = 11;//U
  71   2                      Seg_Buf[5] = (unsigned char)Voltage;
  72   2                      Seg_Buf[6] = (unsigned int)(Voltage * 100) / 10 % 10;
  73   2                      Seg_Buf[7] = (unsigned int)(Voltage * 100) % 10;
  74   2              }
  75   1              else//å¤„äºç”µå‹è¾“å‡ºç•Œé¢
  76   1              {
  77   2                      Seg_Buf[0] = 12;//F
  78   2                      Seg_Buf[5] = (unsigned char)Voltage_Output;
  79   2                      Seg_Buf[6] = (unsigned int)(Voltage_Output * 100) / 10 % 10;//è¿™é‡Œç”¨intæ˜¯å› ä¸ºcharåªåˆ°255
  80   2                      Seg_Buf[7] = (unsigned int)(Voltage_Output * 100) % 10;         
  81   2              }
  82   1              
  83   1      }
*** WARNING C280 IN LINE 55 OF main.c: 'i': unreferenced local variable
  84          
  85          /* å…¶ä»–æ˜¾ç¤ºå‡½æ•° */
  86          void Led_Proc()
  87          {
  88   1              unsigned char i;//ç”¨äºForå¾ªç¯
  89   1              DA_Write(Voltage_Output*51);//å®æ—¶è¾“å‡ºç”µå‹å€¼
  90   1              for(i=0;i<2;i++)//äº’æ–¥ç‚¹äº®
  91   1                      ucLed[i] = (i==Seg_Disp_Mode);
  92   1              if(Voltage < 1.5 || (Voltage >= 2.5 && Voltage < 3.5))
  93   1                      ucLed[2] = 0;
  94   1              else
  95   1                      ucLed[2] = 1;
  96   1              ucLed[3] = Output_Mode;
  97   1              if(Seg_Enable_Flag == 0) //Ledä¸ä½¿èƒ½
  98   1              {
  99   2                      for(i=0;i<8;i++)//ç†„ç­æ‰€æœ‰Led
 100   2                              ucLed[i] = 0;
 101   2              }
 102   1      }
 103          
 104          /* å®šæ—¶å™¨0ä¸­æ–­åˆå§‹åŒ–å‡½æ•° */
 105          void Timer0Init(void)           //1æ¯«ç§’@12.000MHz
 106          {
 107   1              AUXR &= 0x7F;           //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
 108   1              TMOD &= 0xF0;           //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 109   1              TL0 = 0x18;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 110   1              TH0 = 0xFC;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 111   1              TF0 = 0;                //æ¸…é™¤TF0æ ‡å¿—
 112   1              TR0 = 1;                //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 113   1              ET0 = 1;    //å®šæ—¶å™¨ä¸­æ–­0æ‰“å¼€
 114   1              EA = 1;     //æ€»ä¸­æ–­æ‰“å¼€
C51 COMPILER V9.60.7.0   MAIN                                                              04/01/2024 22:20:07 PAGE 3   

 115   1      }
 116          
 117          /* å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•° */
 118          void Timer0Server() interrupt 1
 119          {  
 120   1              if(++Key_Slow_Down == 10) Key_Slow_Down = 0;//é”®ç›˜å‡é€Ÿä¸“ç”¨
 121   1              if(++Seg_Slow_Down == 500) Seg_Slow_Down = 0;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨
 122   1              if(++Seg_Pos == 8) Seg_Pos = 0;//æ•°ç ç®¡æ˜¾ç¤ºä¸“ç”¨
 123   1              if(Seg_Enable_Flag == 1)
 124   1                      Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
 125   1              else
 126   1                      Seg_Disp(Seg_Pos,10,0);
 127   1              Led_Disp(Seg_Pos,ucLed[Seg_Pos]);
 128   1      }
 129          
 130          /* Main */
 131          void main()
 132          {
 133   1              System_Init();
 134   1              Timer0Init();
 135   1              while (1)
 136   1              {
 137   2                      Key_Proc();
 138   2                      Seg_Proc();
 139   2                      Led_Proc();
 140   2              }
 141   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    584    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     40       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
