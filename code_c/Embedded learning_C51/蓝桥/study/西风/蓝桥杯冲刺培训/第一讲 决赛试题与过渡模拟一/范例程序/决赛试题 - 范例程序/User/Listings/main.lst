C51 COMPILER V9.54   MAIN                                                                  11/16/2022 22:49:11 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /* å¤´æ–‡ä»¶å£°æ˜åŒº */
   2          #include <REGX52.H>//å•ç‰‡æœºå¯„å­˜å™¨ä¸“ç”¨å¤´æ–‡ä»¶
   3          #include <Key.h>//æŒ‰é”®åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   4          #include <Seg.h>//æ•°ç ç®¡åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   5          #include <intrins.h>
   6          
   7          /* å˜é‡å£°æ˜åŒº */
   8          unsigned char Key_Val,Key_Down,Key_Old;//æŒ‰é”®ä¸“ç”¨å˜é‡
   9          unsigned char Key_Slow_Down;//æŒ‰é”®å‡é€Ÿä¸“ç”¨å˜é‡
  10          unsigned char Seg_Buf[6] = {10,10,10,10,10,10};//æ•°ç ç®¡æ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  11          unsigned char Seg_Point[6] = {0,0,0,0,0,0};//æ•°ç ç®¡å°æ•°ç‚¹æ•°æ®å­˜æ”¾æ•°ç»„
  12          unsigned char Seg_Pos;//æ•°ç ç®¡æ‰«æä¸“ç”¨å˜é‡
  13          unsigned int Seg_Slow_Down;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨å˜é‡
  14          unsigned char Seg_Disp_Mode;//æ•°ç ç®¡æ˜¾ç¤ºæ¨¡å¼å˜é‡ 0-è¿è¡ŒçŠ¶æ€ç•Œé¢ 1-æµè½¬æ—¶é—´è®¾ç½®ç•Œé¢ 
             -2-æ•°æ®æ˜¾ç¤ºç•Œé¢
  15          bit System_Flag;//ç³»ç»Ÿä½¿èƒ½æ ‡å¿—ä½ 0-æš‚åœ 1-å¯åŠ¨ ä¸Šç”µé»˜è®¤å¤„äºæš‚åœçŠ¶æ€
  16          unsigned char Led_Mode;//Ledæ¨¡å¼æ ‡å¿—ä½
  17          unsigned int Led_Time_Data[4] = {400,400,400,400};//Ledæµè½¬æ—¶é—´æ•°æ®å­˜æ”¾æ•°ç»„
  18          unsigned int Sys_Tick;//ç³»ç»Ÿè®¡æ—¶å™¨ä¸“ç”¨å˜é‡
  19          unsigned char ucLed = 0xfe;//Ledæ•°æ®å­˜æ”¾æ•°ç»„
  20          unsigned char ucLed_Data[4] = {0x7e,0xbd,0xdb,0xe7};//æ¨¡å¼3ã€4æ•°æ®å­˜æ”¾æ•°ç»„
  21          unsigned char ucLed_Data_Index;//æ¨¡å¼3ã€4æ•°ç»„æŒ‡é’ˆ
  22          bit Set_Flag;//è®¾ç½®æ ‡å¿—ä½ 0-æ¨¡å¼ç¼–å· 1-æµè½¬é—´éš”
  23          unsigned int Led_Time_Set[4];//Ledæµè½¬æ•°æ®è®¾ç½®æ•°ç»„
  24          unsigned char Led_Time_Set_Index;//Ledæµè½¬æ•°æ®è®¾ç½®æ•°ç»„æŒ‡é’ˆ
  25          bit Seg_Star_Flag;//æ•°ç ç®¡é—ªçƒæ ‡å¿—ä½
  26          unsigned int Timer_400Ms;//400æ¯«ç§’å˜é‡
  27          bit Data_Disp_Flag;//æ•°æ®æ˜¾ç¤ºæ ‡å¿—ä½ 0-ä¸æ˜¾ç¤º 1-æ˜¾ç¤º
  28          unsigned char Led_Data;//Ledæ•°æ®å‚¨å­˜å˜é‡
  29          
  30          /* é”®ç›˜å¤„ç†å‡½æ•° */
  31          void Key_Proc()
  32          {
  33   1        unsigned char i;//Forå¾ªç¯ä¸“ç”¨å˜é‡
  34   1        if(Key_Slow_Down) return;
  35   1        Key_Slow_Down = 1;//é”®ç›˜å‡é€Ÿç¨‹åº
  36   1      
  37   1        Key_Val = Key_Read();//å®æ—¶è¯»å–é”®ç å€¼
  38   1        Key_Down = Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸‹é™æ²¿
  39   1        Key_Old = Key_Val;//è¾…åŠ©æ‰«æå˜é‡
  40   1        
  41   1        if(System_Flag == 0)//ç³»ç»Ÿå¤„äºæš‚åœçŠ¶æ€
  42   1        {
  43   2          if(Key_Old == 4 && Seg_Disp_Mode == 0)//åœ¨æ˜¾ç¤ºç•Œé¢ä¸‹é•¿æŒ‰S4
  44   2            Data_Disp_Flag = 1;//æ˜¾ç¤ºæ•°æ®
  45   2          else
  46   2            Data_Disp_Flag = 0;//æ˜¾ç¤ºçŠ¶æ€
  47   2        }
  48   1        else
  49   1          Data_Disp_Flag = 0;
  50   1        
  51   1        switch(Key_Down)
  52   1        {
  53   2          case 7://å¯åŠ¨æš‚åœæŒ‰é”®
C51 COMPILER V9.54   MAIN                                                                  11/16/2022 22:49:11 PAGE 2   

  54   2            System_Flag ^= 1;
  55   2          break;
  56   2          case 6://è®¾ç½®åˆ‡æ¢æŒ‰é”®
  57   2            if(Seg_Disp_Mode == 0)//è‹¥åœ¨æ˜¾ç¤ºç•Œé¢ä¸‹ä½¿èƒ½æ­¤æŒ‰é”®
  58   2            {
  59   3              for(i=0;i<4;i++)//è¯»å–å½“å‰è®¾ç½®æ•°æ®
  60   3                Led_Time_Set[i] = Led_Time_Data[i];
  61   3              Seg_Disp_Mode = 1;//è·³è½¬åˆ°å‚æ•°è®¾ç½®ç•Œé¢
  62   3            }
  63   2            else if(Seg_Disp_Mode == 1)//else-ä¸ºäº†é¿å…ç¬¬ä¸€æ¬¡æŒ‰ä¸‹åç›´æ¥æ‰§è¡Œä¸‹åˆ—ç¨‹åº æ‰€ä»¥éœ€è¦å
             -¦å¤–åŠ elseä½¿å¾—åœ¨æ‰§è¡Œå®Œifè¯­å¥åè·³å‡ºåˆ¤æ–­ä¸»ä½“
  64   2            {
  65   3              Set_Flag ^= 1;//ç”¨äºåˆ¤æ–­è®¾ç½®å¤„äºå“ªä¸ªçŠ¶æ€çš„å˜é‡                        
  66   3              if(Set_Flag == 0)//ç¬¬äºŒæ¬¡è·³è½¬åˆ°æ¨¡å¼è®¾ç½®çŠ¶æ€
  67   3              {
  68   4                for(i=0;i<4;i++)
  69   4                  Led_Time_Data[i] = Led_Time_Set[i];//ä¿å­˜å½“å‰è®¾ç½®æ•°æ®
  70   4                Seg_Disp_Mode = 0;
  71   4              }
  72   3            }
  73   2          break;
  74   2          case 5://å‚æ•°+
  75   2            if(Seg_Disp_Mode == 1)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
  76   2            {
  77   3              if(Set_Flag == 0)//ç¼–å·è®¾ç½®
  78   3              {
  79   4                if(++Led_Time_Set_Index == 4)
  80   4                  Led_Time_Set_Index = 0;
  81   4              }
  82   3              else
  83   3              {
  84   4                Led_Time_Set[Led_Time_Set_Index] = Led_Time_Set[Led_Time_Set_Index]+100;
  85   4                if(Led_Time_Set[Led_Time_Set_Index] >= 1300)
  86   4                  Led_Time_Set[Led_Time_Set_Index] = 400;
  87   4              }
  88   3            }
  89   2          break;
  90   2          case 4://å‚æ•°-
  91   2            if(Seg_Disp_Mode == 1)//å¤„äºå‚æ•°è®¾ç½®ç•Œé¢
  92   2            {
  93   3              if(Set_Flag == 0)//ç¼–å·è®¾ç½®
  94   3              {
  95   4                if(--Led_Time_Set_Index == 255)
  96   4                  Led_Time_Set_Index = 3;
  97   4              }
  98   3              else
  99   3              {
 100   4                Led_Time_Set[Led_Time_Set_Index] = Led_Time_Set[Led_Time_Set_Index]-100;
 101   4                if(Led_Time_Set[Led_Time_Set_Index] <= 300)
 102   4                  Led_Time_Set[Led_Time_Set_Index] = 1200;
 103   4              }
 104   3            }
 105   2          break;    
 106   2        }
 107   1      }
 108          
 109          /* ä¿¡æ¯å¤„ç†å‡½æ•° */
 110          void Seg_Proc()
 111          {
 112   1        unsigned char i = 2;//ç”¨äºç†„ç­é«˜ä½æœªå¯ç”¨æ•°ç ç®¡
 113   1        if(Seg_Slow_Down) return;
 114   1        Seg_Slow_Down = 1;//æ•°ç ç®¡å‡é€Ÿç¨‹åº
C51 COMPILER V9.54   MAIN                                                                  11/16/2022 22:49:11 PAGE 3   

 115   1      
 116   1        switch(Seg_Disp_Mode)
 117   1        {
 118   2          case 0://è¿è¡ŒçŠ¶æ€æ˜¾ç¤ºç•Œé¢
 119   2            if(Data_Disp_Flag == 0)
 120   2            {
 121   3              Seg_Buf[0] = System_Flag?11:12;//11-S 12-R
 122   3              Seg_Buf[1] = Led_Mode+1;
 123   3              Seg_Buf[2] = Led_Time_Data[Led_Mode] / 1000 % 10;
 124   3              Seg_Buf[3] = Led_Time_Data[Led_Mode] / 100 % 10;
 125   3              Seg_Buf[4] = Led_Time_Data[Led_Mode] / 10 % 10;
 126   3              Seg_Buf[5] = Led_Time_Data[Led_Mode] % 10;
 127   3              while(Seg_Buf[i] == 0)//ä½¿ç”¨å¾ªç¯ä½“ç»“æ„ä»¤é«˜ä½ä¸º0çš„æ•°ç ç®¡ç†„ç­ ç›´åˆ°ä¸ä¸º0æ—¶é€€å‡º
 128   3              {
 129   4                Seg_Buf[i] = 10;
 130   4                i++;
 131   4              }
 132   3            }
 133   2            else
 134   2            {
 135   3              Seg_Buf[0] = 0;
 136   3              Seg_Buf[1] = 12;
 137   3              Seg_Buf[2] = 13;
 138   3              Seg_Buf[3] = Led_Mode+1;
 139   3              Seg_Buf[4] = Led_Data / 10;
 140   3              Seg_Buf[5] = Led_Data % 10;
 141   3            }
 142   2          break;
 143   2          case 1://æµè½¬æ—¶é—´è®¾ç½®ç•Œé¢
 144   2            Seg_Buf[0] = 13;
 145   2            Seg_Buf[1] = Led_Time_Set_Index+1;
 146   2            Seg_Buf[2] = Led_Time_Set[Led_Time_Set_Index] / 1000 % 10;
 147   2            Seg_Buf[3] = Led_Time_Set[Led_Time_Set_Index] / 100 % 10;
 148   2            Seg_Buf[4] = Led_Time_Set[Led_Time_Set_Index] / 10 % 10;
 149   2            Seg_Buf[5] = Led_Time_Set[Led_Time_Set_Index] % 10;
 150   2            if(Set_Flag == 0)
 151   2            {
 152   3              Seg_Buf[0] = Seg_Star_Flag?13:10;
 153   3              Seg_Buf[1] = Seg_Star_Flag?Led_Time_Set_Index+1:10;
 154   3            }
 155   2            else
 156   2            {
 157   3              Seg_Buf[2] = Seg_Star_Flag?Led_Time_Set[Led_Time_Set_Index] / 1000 % 10:10;
 158   3              Seg_Buf[3] = Seg_Star_Flag?Led_Time_Set[Led_Time_Set_Index] / 100 % 10:10;
 159   3              Seg_Buf[4] = Seg_Star_Flag?Led_Time_Set[Led_Time_Set_Index] / 10 % 10:10;
 160   3              Seg_Buf[5] = Seg_Star_Flag?Led_Time_Set[Led_Time_Set_Index] % 10:10;        
 161   3            }
 162   2            
 163   2            while(Seg_Buf[i] == 0)//ä½¿ç”¨å¾ªç¯ä½“ç»“æ„ä»¤é«˜ä½ä¸º0çš„æ•°ç ç®¡ç†„ç­ ç›´åˆ°ä¸ä¸º0æ—¶é€€å‡º
 164   2            {
 165   3              Seg_Buf[i] = 10;
 166   3              i++;
 167   3            }   
 168   2          break;
 169   2        }
 170   1        Seg_Point[0] = Seg_Point[1] = Data_Disp_Flag&(!Data_Disp_Flag)?0:1;
 171   1      }
 172          
 173          /* å…¶ä»–æ˜¾ç¤ºå‡½æ•° */
 174          void Led_Proc()
 175          {
 176   1        unsigned char i;//ç”¨äºå¾ªç¯åˆ¤æ–­
C51 COMPILER V9.54   MAIN                                                                  11/16/2022 22:49:11 PAGE 4   

 177   1        P1 = ucLed;
 178   1        if(Sys_Tick == Led_Time_Data[Led_Mode])//å½“è®¡æ—¶å™¨èµ°åˆ°å½“å‰æ¨¡å¼è®¾å®šçš„æµè½¬æ—¶é—´é—´éš”æ—¶
 179   1        {
 180   2          Sys_Tick = 0;//è®¡æ—¶å™¨å¤ä½ ä¾¿äºä¸‹æ¬¡å¾ªç¯
 181   2          switch(Led_Mode)//æ ¹æ®Led_Modeçš„ä¸åŒ é€‰æ‹©ä¸åŒçš„å½©ç¯è¿è¡Œæ¨¡å¼
 182   2          {
 183   3            case 0:
 184   3              if(ucLed == 0x7e)//åˆ¤æ–­æ˜¯å¦ä»æ¨¡å¼4åˆ‡æ¢è‡³æ¨¡å¼1 è‹¥æ˜¯ï¼Œåˆ™å¤ä½ucLedæ•°æ®
 185   3                ucLed = 0xfe;
 186   3              else
 187   3              {
 188   4                ucLed = _crol_(ucLed,1);//æ¨¡å¼1 L1-L8
 189   4                if(ucLed == 0x7f) Led_Mode = 1;//å½“L8ç‚¹äº®æ—¶ è·³è½¬åˆ°æ¨¡å¼2
 190   4              }
 191   3            break;
 192   3            case 1:
 193   3              ucLed = _cror_(ucLed,1);//æ¨¡å¼2 L8-L1
 194   3              if(ucLed == 0xfe) Led_Mode = 2;//å½“L1ç‚¹äº®æ—¶ è·³è½¬åˆ°æ¨¡å¼3
 195   3            break;
 196   3            case 2:
 197   3              ucLed = ucLed_Data[ucLed_Data_Index];//æ¨¡å¼3 ä»å¤–å¾€å†…
 198   3              if(++ucLed_Data_Index == 4)//å½“æŒ‡é’ˆæº¢å‡º å³å®Œæˆä¸€æ¬¡å¾ªç¯æ—¶ è·³è½¬åˆ°æ¨¡å¼4
 199   3              {
 200   4                Led_Mode = 3;
 201   4                ucLed_Data_Index = 3;//æŒ‡é’ˆå¤ä½è‡³æ¨¡å¼å››åˆå§‹æ•°æ®
 202   4              }
 203   3            break;
 204   3            case 3:
 205   3              ucLed = ucLed_Data[ucLed_Data_Index];//æ¨¡å¼4 ä»å†…å¾€å¤–
 206   3              if(--ucLed_Data_Index == 255)//å½“æŒ‡é’ˆæº¢å‡º å³å®Œæˆä¸€æ¬¡å¾ªç¯æ—¶ è·³è½¬åˆ°æ¨¡å¼1
 207   3              { 
 208   4                Led_Mode = 0;
 209   4                ucLed_Data_Index = 0; //æŒ‡é’ˆå¤ä½è‡³æ¨¡å¼ä¸‰åˆå§‹æ•°æ®
 210   4              }
 211   3            break;
 212   3          }
 213   2        }
 214   1        /* æ•°æ®è¯»å–è®¾è®¡æ€è·¯ */
 215   1        i = 0;//æ¯æ¬¡å¾ªç¯åˆ¤æ–­å‰å°†iç½®0ï¼Œä¾¿äºè¯»å–LedçŠ¶æ€
 216   1        while((~ucLed & (0x01 << i)) != (0x01 << i))
 217   1          i++;
 218   1        if(Led_Mode < 2)//è‹¥å¤„äºå‰ä¸¤ç§æ¨¡å¼ï¼Œåˆ™æ•°æ®ç›´æ¥ç­‰äºi+1
 219   1          Led_Data = i+1;
 220   1        else
 221   1          Led_Data = (i+1)*10+(8-(i+1));//è‹¥å¤„äºåä¸¤ç§æ¨¡å¼ï¼Œåˆ™é«˜ä½æ•°æ®ç­‰äºi+1ï¼Œæ ¹æ®å¯¹ç§°å˜æ¢
             -ï¼Œä½ä½åŠ é«˜ä½çš„æ•°å€¼ä¹‹å’Œç­‰äº8
 222   1      }
 223          
 224          /* å®šæ—¶å™¨0ä¸­æ–­åˆå§‹åŒ–å‡½æ•° */
 225          void Timer0Init(void)   //1æ¯«ç§’@12.000MHz
 226          {
 227   1        TMOD &= 0xF0;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 228   1        TMOD |= 0x01;   //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
 229   1        TL0 = 0x18;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 230   1        TH0 = 0xFC;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 231   1        TF0 = 0;    //æ¸…é™¤TF0æ ‡å¿—
 232   1        TR0 = 1;    //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
 233   1        ET0 = 1;    //å®šæ—¶å™¨0ä¸­æ–­æ‰“å¼€
 234   1        EA = 1;     //æ€»ä¸­æ–­æ‰“å¼€
 235   1      }
 236          
 237          /* å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•° */
C51 COMPILER V9.54   MAIN                                                                  11/16/2022 22:49:11 PAGE 5   

 238          void Timer0Server() interrupt 1
 239          {
 240   1        TL0 = 0x18;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 241   1        TH0 = 0xFC;   //è®¾ç½®å®šæ—¶åˆå§‹å€¼   
 242   1        if(++Key_Slow_Down == 10) Key_Slow_Down = 0;//é”®ç›˜å‡é€Ÿä¸“ç”¨
 243   1        if(++Seg_Slow_Down == 500) Seg_Slow_Down = 0;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨
 244   1        if(++Seg_Pos == 6) Seg_Pos = 0;//æ•°ç ç®¡æ˜¾ç¤ºä¸“ç”¨
 245   1        Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
 246   1        if(System_Flag == 1)//å½“ç³»ç»Ÿå¯åŠ¨æ—¶ è®¡æ—¶å™¨ä¸€æ¯«ç§’è‡ªåŠ ä¸€æ¬¡ 
 247   1          Sys_Tick++;
 248   1        if(++Timer_400Ms == 400)//400æ¯«ç§’è§¦å‘ä¸€æ¬¡
 249   1        {
 250   2          Timer_400Ms = 0;
 251   2          Seg_Star_Flag ^= 1;
 252   2        }
 253   1      }
 254          
 255          /* Main */
 256          void main()
 257          {
 258   1        Timer0Init();
 259   1        while (1)
 260   1        {
 261   2          Key_Proc();
 262   2          Seg_Proc();
 263   2          Led_Proc();
 264   2        }
 265   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1239    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     49       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
