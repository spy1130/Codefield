C51 COMPILER V9.60.7.0   MAIN                                                              03/12/2024 21:09:47 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\Applications\Keil_5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver;..\Sys;..\U
                    -ser) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          # include "STC15F2K60S2.H"
   2          # include "init.h"
   3          # include "timer.h"
   4          # include "Key.h"
   5          #include "LED.h"
   6          
   7          //-----------------------------------------------
   8          /* 函数声明 */
   9          void Key_Proc(void);//按键处理，底层数据变更
  10          
  11          
  12          //-----------------------------------------------
  13          /* 全局变量声明 */
  14          
  15          
  16          //按键专用，基本上永远不变
  17          unsigned char Key_Value;//读取按键的数值存储变量
  18          unsigned char Key_Down, Key_Old;//读取按键的数值存储变量        
  19          
  20          //按键和显示函数减速专用，基本永远不变
  21          unsigned int Key_Slow_Down;//按键减速
  22          
  23          
  24          //根据代码需求发生变化
  25          unsigned char count = 0;
  26          unsigned char pwm_duty = 0;
  27          unsigned char stat = 0;//状态
  28          
  29          /* main */
  30          void main()
  31          {
  32   1              //根据代码需求发生变化
  33   1              init_close();//关闭外设
  34   1              Timer1_Init();//定时器1初始化，并且使能定时器1中断，1ms进入一次
  35   1              Timer0_Init();
  36   1              EA = 1;//打开总中断
  37   1      
  38   1              while(1)
  39   1              {
  40   2                      //永远不变
  41   2                      Key_Proc();//按键处理，底层数据变更
  42   2                      
  43   2              }
  44   1      
  45   1      
  46   1      }
  47          
  48          //-----------------------------------------------
  49          /* Timer1_interrupt routine */
  50          void tm1_isr() interrupt 3
  51          {       
  52   1              
  53   1              //永远不变
  54   1              if(++Key_Slow_Down == 10) Key_Slow_Down = 0;
C51 COMPILER V9.60.7.0   MAIN                                                              03/12/2024 21:09:47 PAGE 2   

  55   1      
  56   1              
  57   1      }
  58          //-----------------------------------------------
  59          
  60          /* Timer0 interrupt routine */
  61          void tm0_isr() interrupt 1 //1/100=0.01s=10ms=1000*10us=100*100us,刚好分成100份，所以用100us
  62          {                          
  63   1              count++;
  64   1              if(count == pwm_duty)
  65   1              {
  66   2                      LED(0x00);
  67   2              }
  68   1              else if(count == 100)
  69   1              {
  70   2                      LED(0x01);
  71   2                      count = 0;
  72   2                      
  73   2              }               
  74   1              
  75   1      }
  76          
  77          //-----------------------------------------------
  78          void Key_Proc(void)//按键处理，底层数据变更
  79          {
  80   1              //永远不变
  81   1              if(Key_Slow_Down) return;
  82   1              Key_Slow_Down = 1;//减速程序
  83   1              //下面3行是消抖
  84   1              Key_Value = Key_BIN();//读取按键按下的编号（临时按键值）
  85   1              Key_Down = Key_Value & (Key_Old ^ Key_Value);//按下为按键值，其它（未按下，按下稳定期，抬起过程中）为0  
  86   1              Key_Old = Key_Value;
  87   1              
  88   1              //根据代码需求发生变化
  89   1              if(Key_Down)//如果捕捉到下降沿跳变
  90   1              {       
  91   2                      if(Key_Down==7)
  92   2                      {
  93   3                              switch(stat)
  94   3                              {
  95   4                                      case 0:
  96   4                                              LED(0x00);      
  97   4                                              TR0 = 0;
  98   4                                              stat = 1;
  99   4                                              
 100   4                                      break;
 101   4                                      
 102   4                                      case 1:
 103   4                                              LED(0x01);
 104   4                                              TR0=1;
 105   4                                              pwm_duty = 10;
 106   4                                              stat = 2;
 107   4                                              
 108   4                                      break;
 109   4                                      
 110   4                                      case 2:
 111   4                                              pwm_duty = 50;
 112   4                                              stat = 3;
 113   4                                              
 114   4                                      break;
 115   4                                      
 116   4                                      case 3:
C51 COMPILER V9.60.7.0   MAIN                                                              03/12/2024 21:09:47 PAGE 3   

 117   4                                              pwm_duty = 90;
 118   4                                              stat = 0;
 119   4                                      break;          
 120   4                              }
 121   3                      }
 122   2              }
 123   1      }
 124          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    215    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
