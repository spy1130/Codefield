C51 COMPILER V9.54   MAIN                                                                  12/10/2023 19:32:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil c51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\mai
                    -n.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /*进行分模块实现*/
   2          # include "init.h"
   3          # include "timer.h"
   4          # include "bsp_seg.h"
   5          # include "bsp_key.h"
   6          # include "bsp_led.h"
   7          # include "stdio.h"
   8          # include "ds1302.h"
   9          # include "onewire.h"
  10          //-----------全局变量的声明------------//
  11          /*数码管专用*/
  12          unsigned char Seg_String[9];
  13          unsigned char Seg_Buf[8];
  14          unsigned char pos=0;
  15          /*减速专用*/
  16          unsigned int Seg_Dly;//数码管专用
  17          unsigned char Key_Dly;//按键专用
  18          /*按键专用*/
  19          unsigned char Key_Old;
  20          /*计时专用*/
  21          unsigned int ulms;
  22          unsigned char Sec;
  23          /*led专用*/
  24          unsigned char ucled;
  25          /*ds1302时钟模块*/
  26          unsigned char PrRtc[3]={15,23,45};
  27          unsigned char W_Rtc_ads[3]={0x84,0x82,0x80};//秒,分，时
  28          /*模式切换标志位*/
  29          unsigned char Seg_Mode_Change=0;
  30          /**/
  31          void Led_Proc()
  32          {
  33   1              switch(Seg_Mode_Change)
  34   1              {
  35   2                      case 1:ucled = 0x3f;break;
  36   2                      case 2:ucled = 0xcf;break;
  37   2                      case 3:ucled = 0xf3;break;
  38   2                      case 4:ucled = 0xfc;break;
  39   2                      default :ucled = 0xff;
  40   2              }
  41   1      }
  42          void Key_Proc()//按键处理函数,按键显示
  43          {
  44   1              unsigned char Key_Val;
  45   1              unsigned char Key_Down;
  46   1              if(Key_Dly)return;
  47   1              Key_Dly = 1;
  48   1      //      Key_Val = Scan_Key();//矩阵键盘
  49   1              Key_Val = Alone_Key();//独立按键
  50   1              Key_Down = Key_Val & (Key_Old ^ Key_Val);
  51   1              Key_Old = Key_Val;
  52   1              if(Key_Down)
  53   1              {
  54   2                      switch(Key_Old)
C51 COMPILER V9.54   MAIN                                                                  12/10/2023 19:32:26 PAGE 2   

  55   2                      {
  56   3                              case 1: Seg_Mode_Change=1;break;
  57   3                              case 2: Seg_Mode_Change=2;break;
  58   3                              case 3: Seg_Mode_Change=3;break;
  59   3                              case 4: Seg_Mode_Change=4;break;
  60   3                      }
  61   2              }
  62   1      }
  63          void Seg_Proc()//显示处理函数
  64          {
  65   1              if(Seg_Dly)return;
  66   1              Seg_Dly = 1;
  67   1              Read_Rtc(PrRtc);
  68   1              switch(Seg_Mode_Change)
  69   1              {
  70   2                      case 1:sprintf(Seg_String,"%02d-%02d-%02d",(unsigned int)PrRtc[0],(unsigned int)PrRtc[1],(unsigned int)P
             -rRtc[2]);break;
  71   2                      
  72   2                      case 2:sprintf(Seg_String,"-----%03d",(unsigned int)Sec);break;
  73   2                      
  74   2                      case 3:sprintf(Seg_String,"%09.4f",Read_Tm()/16.0);break;//改进：如果温度为正前面显示0，为负显示-。
  75   2              }
  76   1              Seg_Tran(Seg_String,Seg_Buf);
  77   1      }
  78          
  79          
  80          
  81          
  82          
  83          
  84          void main()
  85          {
  86   1              Cls_Peripheral();
  87   1              Timer0Init();
  88   1              EA=1;
  89   1              Set_Rtc(PrRtc);
  90   1              while(1)
  91   1              {
  92   2                      Key_Proc();
  93   2                      Seg_Proc();
  94   2                      Led_Proc();
  95   2              }
  96   1      }
  97          
  98          void tm1_slr()  interrupt 1
  99          {
 100   1              if(++ulms == 1000){Sec++;ulms=0;}
 101   1              if(++Key_Dly == 10) {Key_Dly = 0;}
 102   1              if(++Seg_Dly == 500){Seg_Dly = 0;}
 103   1              
 104   1              
 105   1              Led_Init(ucled);
 106   1              Seg_Disp(Seg_Buf,pos);
 107   1              if(++pos==8)   pos=0;
 108   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    403    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.54   MAIN                                                                  12/10/2023 19:32:26 PAGE 3   

   DATA SIZE        =     33    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
