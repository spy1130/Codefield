C51 COMPILER V9.60.7.0   BSP_DS1302                                                        12/11/2023 21:46:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE BSP_DS1302
OBJECT MODULE PLACED IN .\Objects\bsp_ds1302.obj
COMPILER INVOKED BY: E:\Applications\Keil_5\C51\BIN\C51.EXE ..\Driver\bsp_ds1302.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Dr
                    -iver;..\Sys) DEBUG OBJECTEXTEND PRINT(.\Listings\bsp_ds1302.lst) OBJECT(.\Objects\bsp_ds1302.obj)

line level    source

   1          /*
   2            程序说明: DS1302驱动程序
   3            软件环境: Keil uVision 4.10 
   4            硬件环境: CT107单片机综合实训平台 8051，12MHz
   5            日    期: 2011-8-9
   6          */
   7          
   8          #include "bsp_ds1302.h"                                                                                 
   9          
  10          
  11          void Write_Ds1302(unsigned  char temp) 
  12          {
  13   1              unsigned char i;
  14   1              for (i=0;i<8;i++)       
  15   1              { 
  16   2                      SCK=0;
  17   2                      SDA=temp&0x01;
  18   2                      temp>>=1; 
  19   2                      SCK=1;
  20   2              }
  21   1      }   
  22          
  23          void Write_Ds1302_Byte( unsigned char address,unsigned char dat )     
  24          {
  25   1              RST=0;  _nop_();
  26   1              SCK=0;  _nop_();
  27   1              RST=1;  _nop_();  
  28   1              Write_Ds1302(address);  
  29   1              Write_Ds1302(dat);              
  30   1              RST=0; 
  31   1      }
  32          
  33          unsigned char Read_Ds1302_Byte ( unsigned char address )
  34          {
  35   1              unsigned char i,temp=0x00;
  36   1              RST=0;  _nop_();
  37   1              SCK=0;  _nop_();
  38   1              RST=1;  _nop_();
  39   1              Write_Ds1302(address);
  40   1              for (i=0;i<8;i++)       
  41   1              {               
  42   2                      SCK=0;
  43   2                      temp>>=1;       
  44   2                      if(SDA)
  45   2                      temp|=0x80;     
  46   2                      SCK=1;
  47   2              } 
  48   1              RST=0;  _nop_();
  49   1              SCK=0;  _nop_();
  50   1              SCK=1;  _nop_();
  51   1              SDA=0;  _nop_();
  52   1              SDA=1;  _nop_();
  53   1              return (temp);                  
  54   1      }
C51 COMPILER V9.60.7.0   BSP_DS1302                                                        12/11/2023 21:46:01 PAGE 2   

  55          
  56          
  57          //函数名：设置DS1302时分秒函数
  58          //入口参数：包含时分秒数据的数组指针
  59          //返回值：无
  60          //函数功能：设置DS1302时分秒函数
  61          
  62          void Set_Rtc(unsigned char* ucRtc)
  63          {
  64   1              unsigned char temp;//中间局部变量，存放时分秒
  65   1              
  66   1              Write_Ds1302_Byte(0x8e, 0);//wp = 0, 允许写操作
  67   1              
  68   1              temp = (((ucRtc[0]/10)<<4)|(ucRtc[0]%10)) ;//数组的第0个数据，小时，用BCD码的形式存储
  69   1              Write_Ds1302_Byte(0x84, temp);//写入到小时的寄存器
  70   1              temp = (((ucRtc[1]/10)<<4)|(ucRtc[1]%10)) ;//数组的第1个数据，分钟，用BCD码的形式存储
  71   1              Write_Ds1302_Byte(0x82, temp);//写入到分钟的寄存器
  72   1              temp = (((ucRtc[2]/10)<<4)|(ucRtc[2]%10)) ;//数组的第2个数据，秒，用BCD码的形式存储
  73   1              Write_Ds1302_Byte(0x80, temp);//写入到秒的寄存器
  74   1      
  75   1              Write_Ds1302_Byte(0x8e, 0x80);//wp = 1, 不允许写操作
  76   1      }
  77          
  78          
  79          
  80          //函数名：读取DS1302时分秒函数
  81          //入口参数：将读取到的时分秒数据存放到数组的指针
  82          //返回值：无
  83          //函数功能：读取DS1302时分秒函数，将读取到的数据放到数组指针指向的位置
  84          
  85          void Read_Rtc(unsigned char* ucRtc)
  86          {
  87   1              unsigned char temp;//中间局部变量，存放时分秒
  88   1      
  89   1              temp = Read_Ds1302_Byte (0x85);//读取小时数据
  90   1              ucRtc[0] = (((temp>>4)*10) + (temp&0x0F));// 23(BCD) = 0010 0011(B) = 35(D),不能直接赋值，要进行BCD到十进
             -制数据的转换
  91   1              temp = Read_Ds1302_Byte (0x83);//读取分钟数据
  92   1              ucRtc[1] = (((temp>>4)*10) + (temp&0x0F));// 23(BCD) = 0010 0011(B) = 35(D),不能直接赋值，要进行BCD到十进
             -制数据的转换        
  93   1              temp = Read_Ds1302_Byte (0x81);//读取秒数据
  94   1              ucRtc[2] = (((temp>>4)*10) + (temp&0x0F));// 23(BCD) = 0010 0011(B) = 35(D),不能直接赋值，要进行BCD到十进
             -制数据的转换        
  95   1              
  96   1      }
  97          
  98          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    250    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
