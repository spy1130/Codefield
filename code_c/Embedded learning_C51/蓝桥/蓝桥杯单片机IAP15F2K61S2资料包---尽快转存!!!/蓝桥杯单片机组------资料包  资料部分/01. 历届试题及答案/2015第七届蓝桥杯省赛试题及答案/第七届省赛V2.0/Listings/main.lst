C51 COMPILER V9.54   MAIN                                                                  12/20/2017 18:59:14 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\keil   55\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "STC15F2K60S2.h"
   2          #include "onewire.h"
   3          
   4          #define uint unsigned int
   5          #define uchar unsigned char
   6          
   7          uchar discount;
   8          uchar dsbuff[8]={10,0,10,11,0,0,0,0};
   9          uchar code tab[]={0XC0,0XF9,0XA4,0XB0,0X99,0X92,0X82,0XF8,0X80,0X90,0XBF,0XFF,0XC6};
  10          uchar key1=0,key2=0,key3=0,key4=0;
  11          uchar count0,count1;
  12          uchar flag1,flag2;
  13          uchar shijian=0;
  14          uchar tt=0;
  15          void delayms(uint xms)
  16          {
  17   1        uint i,j;
  18   1        for(i=xms;i>0;i--)
  19   1        for(j=110;j>0;j--);
  20   1      }
  21          
  22          void allinit()
  23          {
  24   1        P2=0XA0;P0=0X00;
  25   1        P2=0X80;P0=0XFF;
  26   1        P2=0XC0;P0=0XFF;
  27   1        P2=0XE0;P0=0XFF;
  28   1      }
  29          
  30          void display()
  31          {
  32   1        P2=0XEF;
  33   1        P0=0XFF;
  34   1        P2=0X1F;
  35   1        
  36   1        P2=0XCF;
  37   1        P0=1<<discount;
  38   1        P2=0X1F;
  39   1        
  40   1        P2=0XEF;
  41   1        P0=tab[dsbuff[discount]];
  42   1        P2=0X1F;
  43   1        
  44   1        if(++discount==8) discount=0;
  45   1        
  46   1      }
  47          
  48          void Timer0Init(void)   //2毫秒@11.0592MHz
  49          {
  50   1        AUXR |= 0x80;   //定时器时钟1T模式
  51   1        TMOD &= 0xF0;   //设置定时器模式
  52   1        TL0 = 0x9A;   //设置定时初值
  53   1        TH0 = 0xA9;   //设置定时初值
  54   1        TF0 = 0;    //清除TF0标志
C51 COMPILER V9.54   MAIN                                                                  12/20/2017 18:59:14 PAGE 2   

  55   1        TR0 = 1;    //定时器0开始计时
  56   1        EA=1;
  57   1        ET0=1;
  58   1      }
  59          
  60          void key()
  61          {
  62   1        if(P30==0)
  63   1        {
  64   2          delayms(10);
  65   2          if(P30==0)
  66   2          {
  67   3            key1=1;
  68   3            key2=0;
  69   3            key3=0;
  70   3            key4=0;
  71   3          }
  72   2          while(!P30);
  73   2        }
  74   1        if(P31==0)
  75   1        {
  76   2          delayms(10);
  77   2          if(P31==0)
  78   2          {
  79   3            key2=1;
  80   3            key1=0;
  81   3            key3=0;
  82   3            key4=0;
  83   3          }
  84   2          while(!P31);
  85   2        }
  86   1        if(P32==0)
  87   1        {
  88   2          delayms(10);
  89   2          if(P32==0)
  90   2          {
  91   3            key3=1;
  92   3            key2=0;
  93   3            key1=0;
  94   3            key4=0;
  95   3            tt++;
  96   3            shijian=60;
  97   3          }
  98   2          while(!P32);
  99   2        }
 100   1        if(P33==0)
 101   1        {
 102   2          delayms(10);
 103   2          if(P33==0)
 104   2          {
 105   3            key4++;
 106   3            key2=0;
 107   3            key3=0;
 108   3            key1=0;
 109   3            if(key4==4) key4=1;
 110   3          }
 111   2          while(!P33);
 112   2        }
 113   1      }
 114          
 115          void Timer1Init(void)   //5毫秒@11.0592MHz
 116          {
C51 COMPILER V9.54   MAIN                                                                  12/20/2017 18:59:14 PAGE 3   

 117   1        AUXR |= 0x40;   //定时器时钟1T模式
 118   1        TMOD &= 0x0F;   //设置定时器模式
 119   1        TL1 = 0x00;   //设置定时初值
 120   1        TH1 = 0x28;   //设置定时初值
 121   1        TF1 = 0;    //清除TF1标志
 122   1        TR1 = 1;    //定时器1开始计时
 123   1        EA=1;
 124   1        ET0=1;
 125   1      }
 126          
 127          void main()
 128          {
 129   1        uchar wendu;
 130   1        allinit();
 131   1        Timer0Init();
 132   1        while(1)
 133   1        {
 134   2          if(flag1==1)
 135   2          {
 136   3            flag1=0;
 137   3            key();
 138   3          }
 139   2          if(key4==1)
 140   2          {
 141   3            P2=0X80;P0=0X7F;
 142   3            dsbuff[7]=shijian%10;
 143   3            dsbuff[6]=shijian/10%100;
 144   3            dsbuff[5]=shijian/100%10;
 145   3            dsbuff[4]=shijian/1000;
 146   3            dsbuff[2]=10;
 147   3            dsbuff[1]=1;
 148   3            dsbuff[0]=10;
 149   3          }
 150   2          if(key4==2)
 151   2          {
 152   3            P2=0X80;P0=0XBF;
 153   3            dsbuff[7]=shijian%10;
 154   3            dsbuff[6]=shijian/10%100;
 155   3            dsbuff[5]=shijian/100%10;
 156   3            dsbuff[4]=shijian/1000;
 157   3            dsbuff[2]=10;
 158   3            dsbuff[1]=2;
 159   3            dsbuff[0]=10;
 160   3          }
 161   2          if(key4==3)
 162   2          {
 163   3            P2=0X80;P0=0XDF;
 164   3            dsbuff[7]=shijian%10;
 165   3            dsbuff[6]=shijian/10%100;
 166   3            dsbuff[5]=shijian/100%10;
 167   3            dsbuff[4]=shijian/1000;
 168   3            dsbuff[2]=10;
 169   3            dsbuff[1]=3;
 170   3            dsbuff[0]=10;
 171   3          }
 172   2          if(key1==1)
 173   2          {
 174   3            wendu=readtemp();
 175   3            dsbuff[7]=12;
 176   3            dsbuff[6]=wendu%10;
 177   3            dsbuff[5]=wendu/10;
 178   3            dsbuff[4]=11;
C51 COMPILER V9.54   MAIN                                                                  12/20/2017 18:59:14 PAGE 4   

 179   3            dsbuff[3]=11;
 180   3            dsbuff[2]=10;
 181   3            dsbuff[1]=4;
 182   3            dsbuff[0]=10;
 183   3          }
 184   2          
 185   2        }
 186   1      }
 187          
 188          void Timer0() interrupt 1
 189          {
 190   1        display();
 191   1        count0++;
 192   1        count1++;
 193   1        if(count0==1) 
 194   1        {
 195   2          count0=0;
 196   2          flag1=1;
 197   2        }
 198   1      }
 199          
 200          void Timer1() interrupt 3
 201          {
 202   1        if(key3==1)
 203   1        {
 204   2          count1++;
 205   2          if(count1==200) 
 206   2          {
 207   3            count1=0;
 208   3            shijian=tt*shijian;
 209   3            shijian--;
 210   3            if(shijian==0) shijian=0;
 211   3          }
 212   2        }
 213   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    621    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
