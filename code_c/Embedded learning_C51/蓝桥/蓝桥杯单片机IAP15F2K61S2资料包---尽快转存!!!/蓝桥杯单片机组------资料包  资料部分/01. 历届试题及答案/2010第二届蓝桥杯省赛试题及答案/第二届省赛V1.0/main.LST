C51 COMPILER V9.02   MAIN                                                                  03/19/2016 10:01:02 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Program Files\keill\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "24c02.h"
   3          #include "smg.h"
   4          #include "ds18b20.h"
   5          unsigned char keysta[4]={1,1,1,1},DQTH,DQTL,temp;
   6          bit flag1s;
   7          void key_4();
   8          void warningDS1302();
   9          void Timer1Init(void);
  10          void main()
  11          {
  12   1              P0=0xff;
  13   1              P2&=0x1f;
  14   1              P2|=0x80;
  15   1              P2&=0x1f;
  16   1              P0=0x00;
  17   1              P2&=0x1f;
  18   1              P2|=0xa0;
  19   1              P2&=0x1f;
  20   1              DQTH=at24c02_read(0x00);
  21   1              DQTL=at24c02_read(0x01);
  22   1              Time_T0(1);
  23   1              Timer1Init();
  24   1              while(1)
  25   1              {
  26   2                      if(flag1s)
  27   2                      {
  28   3                              flag1s=0;
  29   3                              temp=read_ds18b20();
  30   3                      }
  31   2                      key_4();
  32   2                      smg_ds18b20(temp,DQTH,DQTL);
  33   2                      warningDS1302();
  34   2              }
  35   1      }
  36          void warningDS1302()
  37          {
  38   1              static bit relay,pwmkey;
  39   1              if(DQTH<temp&&pwmkey==0)
  40   1              {
  41   2                      pwmkey=1;
  42   2                      TR1=1;  
  43   2              }
  44   1              if(DQTH>=temp&&pwmkey==1)
  45   1              {
  46   2                      pwmkey=0;
  47   2                      TR1=0;
  48   2                      P34=1;
  49   2              }
  50   1              if(DQTL<=temp)
  51   1              {
  52   2                      if(relay)
  53   2                      {
  54   3                              relay=0;
  55   3                              P0=0x00;
C51 COMPILER V9.02   MAIN                                                                  03/19/2016 10:01:02 PAGE 2   

  56   3                              P2&=0x1f;
  57   3                              P2|=0xa0;
  58   3                              P2&=0x1f;       
  59   3                      }
  60   2              }
  61   1              if(DQTL>temp)
  62   1              {
  63   2                      if(relay==0)
  64   2                      {
  65   3                              relay=1;
  66   3                              P0=0x00;
  67   3                              P2&=0x1f;
  68   3                              P2|=0xa0;
  69   3                              P04=1;
  70   3                              P2&=0x1f;
  71   3                      }               
  72   2              }
  73   1      }
  74          void key_4()
  75          {
  76   1              static unsigned char keyback[4]={1,1,1,1},i;
  77   1              for(i=0;i<4;i++)
  78   1              {
  79   2                      if(keyback[i]!=keysta[i])
  80   2                      {
  81   3                              if(keyback[i]==0)
  82   3                              {
  83   4                                      switch(i)
  84   4                                      {
  85   5                                              case 0:DQTL--;if(DQTL>100)DQTL=0;at24c02_wirte(0x01,DQTL);break;
  86   5                                              case 1:DQTH--;if(DQTH>100)DQTH=0;if(DQTL>DQTH)DQTH=DQTL;at24c02_wirte(0x00,DQTH);break;
  87   5                                              case 2:DQTL++;if(DQTL>=100)DQTL=99;if(DQTL>DQTH)DQTL=DQTH;at24c02_wirte(0x01,DQTL);break;
  88   5                                              case 3:DQTH++;if(DQTH>=100)DQTH=99;at24c02_wirte(0x00,DQTH);break;
  89   5                                              default:break;
  90   5                                      }
  91   4                              }
  92   3                              keyback[i]=keysta[i];
  93   3                      }
  94   2              }       
  95   1      }
  96          void scanf_key()
  97          {
  98   1              static unsigned char i,keybuf[4]={0xff,0xff,0xff,0xff};
  99   1              keybuf[0]=(keybuf[0]<<1)|P30;
 100   1              keybuf[1]=(keybuf[1]<<1)|P31;
 101   1              keybuf[2]=(keybuf[2]<<1)|P32;
 102   1              keybuf[3]=(keybuf[3]<<1)|P33;
 103   1              for(i=0;i<4;i++)
 104   1              {
 105   2                      if(keybuf[i]==0x00)
 106   2                              keysta[i]=0;
 107   2                      if(keybuf[i]==0xff)
 108   2                              keysta[i]=1;
 109   2              }
 110   1      }
 111          void Timer1Init(void)           //100微秒@11.0592MHz
 112          {
 113   1              AUXR |= 0x40;           //定时器时钟1T模式
 114   1              TMOD &= 0x0F;           //设置定时器模式
 115   1              TL1 = 0xAE;             //设置定时初值
 116   1              TH1 = 0xFB;             //设置定时初值
 117   1              ET1=1;
C51 COMPILER V9.02   MAIN                                                                  03/19/2016 10:01:02 PAGE 3   

 118   1      }
 119          void TimeT0interrupt() interrupt 1
 120          {
 121   1              static unsigned int i;
 122   1              i++;
 123   1              if(i==1000)
 124   1              {
 125   2                      flag1s=1;
 126   2                      i=0;
 127   2              }
 128   1              scanf_key();
 129   1              if(i%2)
 130   1              smg_buff();
 131   1      }
 132          void TimeT1interrupt() interrupt 3
 133          {
 134   1              static unsigned char i;
 135   1              if(i<3&&P34==0)
 136   1              P34=1;
 137   1              else if(i>3&&i<10&&P34==1)
 138   1              P34=0;
 139   1              i++;
 140   1              if(i==10)
 141   1              i=0;
 142   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    550    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
