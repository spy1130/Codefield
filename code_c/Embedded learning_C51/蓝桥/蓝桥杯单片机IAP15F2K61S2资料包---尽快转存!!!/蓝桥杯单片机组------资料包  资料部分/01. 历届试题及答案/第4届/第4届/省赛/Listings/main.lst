C51 COMPILER V9.59.0.0   MAIN                                                              02/13/2022 10:35:37 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil\Keil_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listing
                    -s\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg52.h"
   2          #include "DS1302.h"
   3          #include "LED.h"
   4          #include "BUZZ.h"
   5          #include "IIC.h"
   6          
   7          
   8          sbit S7 = P3^0;
   9          sbit S6 = P3^1;
  10          sbit S5 = P3^2;
  11          sbit S4 = P3^3;
  12          
  13          
  14          bit S7_Flag = 0;
  15          bit S6_Flag = 0;
  16          bit S5_Flag = 0;
  17          bit S4_Flag = 0;
  18          
  19          bit Work_Flag = 0;  //0为自动工作状态，1为手动工作状态
  20          bit DISPLAY_Flag = 0;  // 0为时钟页面， 1为阀度调整页面
  21          bit BUZZ_Flag = 1;    // 0可以报警，1不报警
  22          
  23          sbit LED1 = P0^0;
  24          sbit LED2 = P0^1;
  25          
  26          void Close_Buzz();
  27          void Delay5ms();
  28          void KEY_Press();
  29          
  30          void main()
  31          {
  32   1        int SHIDU = 50;        //shidu为AD转换器测出来的温度，SHIDU为EEPROM中设置的湿度阈值
  33   1        unsigned char shu;
  34   1        unsigned char yi,er,san,si,wu;
  35   1        unsigned char ii = 0;
  36   1        int shidu;
  37   1        Close_Buzz();
  38   1        Init_DS1302();
  39   1        Write_EEPROM(50);
  40   1        while(1)
  41   1        {
  42   2          KEY_Press();
  43   2          shu = PCF();
  44   2          shidu = shu*5/255*99/5;//
  45   2          SHIDU = Read_EEPROM();
  46   2          
  47   2          if (Work_Flag == 0) //自动工作状态,L1
  48   2          {
  49   3            P2 = 0x80;
  50   3            P0 = 0xFE;
  51   3            P2 = 0x00;  
  52   3            P0 = 0x00;
  53   3            
  54   3            Close_B();
C51 COMPILER V9.59.0.0   MAIN                                                              02/13/2022 10:35:37 PAGE 2   

  55   3            if (shidu < SHIDU)
  56   3            {
  57   4              Oppen_R();
  58   4            }
  59   3            else 
  60   3            {
  61   4              Close_R();
  62   4            } 
  63   3          }
  64   2          else   //手动工作状态,L2
  65   2          {
  66   3            P2 = 0x80;
  67   3            P0 = 0xFD;
  68   3            P2 = 0x00;
  69   3            P0 = 0x00;
  70   3          }
  71   2          
  72   2          if (S7_Flag == 1)
  73   2          {
  74   3            S7_Flag = 0;
  75   3            if (Work_Flag == 0)
  76   3            {
  77   4              Work_Flag = 1;
  78   4            }
  79   3            else
  80   3            {
  81   4              Work_Flag = 0;
  82   4            }
  83   3          }
  84   2          
  85   2          if ((S6_Flag == 1) && (Work_Flag == 0)) 
  86   2          {
  87   3            S6_Flag = 0;
  88   3            ii++;
  89   3            if(ii == 1)
  90   3            {
  91   4              DISPLAY_Flag = ~DISPLAY_Flag;
  92   4            }
  93   3            else
  94   3            {
  95   4              ii = 0;
  96   4              DISPLAY_Flag = ~DISPLAY_Flag;
  97   4            }
  98   3          }
  99   2          else if ((S6_Flag == 1) && (Work_Flag == 1))
 100   2          {
 101   3            S6_Flag = 0;
 102   3            BUZZ_Flag = ~BUZZ_Flag;   
 103   3          }
 104   2          
 105   2          if ((S5_Flag == 1) && (Work_Flag == 0) && (DISPLAY_Flag == 1))
 106   2          {
 107   3            S5_Flag = 0;
 108   3            SHIDU++;
 109   3            Write_EEPROM(SHIDU);
 110   3          }
 111   2          
 112   2          if ((S5_Flag == 1) && (Work_Flag == 1))
 113   2          {
 114   3            S5_Flag = 0;
 115   3            Oppen_R();
 116   3          }
C51 COMPILER V9.59.0.0   MAIN                                                              02/13/2022 10:35:37 PAGE 3   

 117   2          
 118   2          if ((S4_Flag == 1) && (Work_Flag == 0) && (DISPLAY_Flag == 1))
 119   2          {
 120   3            S4_Flag = 0;
 121   3            SHIDU--;
 122   3            Write_EEPROM(SHIDU);
 123   3          }
 124   2          
 125   2          if ((S4_Flag == 1) && (Work_Flag == 1))
 126   2          {
 127   3            S4_Flag = 0;
 128   3            Close_R();
 129   3          }     
 130   2      
 131   2          
 132   2      
 133   2          if ((shidu < SHIDU) && (BUZZ_Flag == 0) && (Work_Flag == 1))
 134   2          {
 135   3            Oppen_B();
 136   3          }
 137   2          
 138   2          if ((shidu >= SHIDU) || (BUZZ_Flag == 1) && (Work_Flag == 1))
 139   2          {
 140   3            Close_B();
 141   3          } 
 142   2          
 143   2          if (DISPLAY_Flag == 0)
 144   2          {
 145   3            Read_DS1302();    
 146   3            yi = Display_time[0]>>4;
 147   3            er = Display_time[0]&0x0F;
 148   3            san = 11;
 149   3            si = Display_time[1]>>4;
 150   3            wu = Display_time[1]&0x0F;
 151   3            DS1(yi, er, san, si, wu);   
 152   3            
 153   3            yi = shidu/10;
 154   3            er = shidu%10;
 155   3            DS2(10, yi, er);
 156   3          }
 157   2          else
 158   2          {
 159   3            SHIDU = Read_EEPROM();
 160   3            DS1(11, 11, 10, 10, 10);
 161   3            DS2(10, SHIDU/10, SHIDU%10);
 162   3          }   
 163   2        }
 164   1      }
 165          
 166          
 167          void Close_Buzz()
 168          {
 169   1        P2 = 0xA0;
 170   1        P0 = 0x00;
 171   1        P2 = 0x00;
 172   1        
 173   1      
 174   1        P2 = 0x80;
 175   1        P0 = 0xFF;  
 176   1        P2 = 0x00;
 177   1      }
 178          
C51 COMPILER V9.59.0.0   MAIN                                                              02/13/2022 10:35:37 PAGE 4   

 179          void Delay5ms()   //@11.0592MHz
 180          {
 181   1        unsigned char i, j;
 182   1      
 183   1        i = 54;
 184   1        j = 199;
 185   1        do
 186   1        {
 187   2          while (--j);
 188   2        } while (--i);
 189   1      }
 190          
 191          void KEY_Press()
 192          {
 193   1        if (S7 == 0)
 194   1        {
 195   2          Delay5ms();
 196   2          if (S7 == 0)  
 197   2          {
 198   3            S7_Flag = 1;
 199   3          }
 200   2          while(S7 == 0);
 201   2        }
 202   1        
 203   1        if (S6 == 0)
 204   1        {
 205   2          Delay5ms();
 206   2          if (S6 == 0)  
 207   2          {
 208   3            S6_Flag = 1;
 209   3          }
 210   2          while(S6 == 0);
 211   2        }
 212   1        
 213   1        if (S5 == 0)
 214   1        {
 215   2          Delay5ms();
 216   2          if (S5 == 0)  
 217   2          {
 218   3            S5_Flag = 1;
 219   3          }
 220   2          while(S5 == 0);
 221   2        }
 222   1        
 223   1        if (S4 == 0)
 224   1        {
 225   2          Delay5ms();
 226   2          if (S4 == 0)  
 227   2          {
 228   3            S4_Flag = 1;
 229   3          }
 230   2          while(S4 == 0);
 231   2        }
 232   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    526    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      10
C51 COMPILER V9.59.0.0   MAIN                                                              02/13/2022 10:35:37 PAGE 5   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =      7    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
