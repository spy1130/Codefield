C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE WUKANG
OBJECT MODULE PLACED IN .\Objects\wukang.obj
COMPILER INVOKED BY: C:\keil   55\C51\BIN\C51.EXE wukang.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -wukang.lst) TABS(2) OBJECT(.\Objects\wukang.obj)

line level    source

   1          #include <stc15f2k60s2.h>
   2          #include "onewire.h"
   3          #define uchar unsigned char 
   4          #define uint unsigned int
   5          uchar code tab[] = { 0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90,0xff,0xbf};
   6          uchar dspbuf[]={10,10,10,10,10,10,10,10,10};
   7          uchar shezhi[]={10,3,0,10,10,10,2,0};
   8          uchar sa[]={10,10,10,10};
   9          uchar keyvalue,dspcom=0,wendu,Tflag=0,keyflag=0,keyflag1=0,keyflag2=0,i=0;
  10          uchar a1=0,a2=0;s1=0;d1,d2,d3,b7=0,b4=0,b5=0,b6=0,a4=0,a5=0,a6=0,b10=0;
  11          uint a;
  12          sbit h1=P3^0;
  13          sbit h2=P3^1;
  14          sbit h3=P3^2;
  15          sbit h4=P3^3;
  16          sbit l1=P4^4;
  17          sbit l2=P4^2;
  18          sbit l3=P3^5;
  19          void panduan1();
  20          void keyscan();
  21          void display();
  22          void Delay5ms()   
  23          {
  24   1        unsigned char i, j;
  25   1        i = 54;
  26   1        j = 199;
  27   1        do
  28   1        {
  29   2          while (--j);
  30   2        } while (--i);
  31   1      }
  32          void ledon()// 开小灯1
  33          {
  34   1        P0=0XFE;
  35   1        P2=0X80;
  36   1        P2=P2&0X1F;
  37   1      }
  38          void ledoff()//关小灯1
  39          {
  40   1         P0=0XFF;
  41   1         P2=0X80;
  42   1         P2=P2&0X1F;
  43   1      }
  44          void ledon1()// 开小灯2
  45          {
  46   1         P0=0XFd;
  47   1         P2=(P2&0X1F)|0X80;
  48   1         P2=P2&0X1F;
  49   1      }
  50          void ledoff1()// 关小灯2
  51          {
  52   1         P0=0XFf;
  53   1         P2=(P2&0X1F)|0X80;
  54   1         P2=P2&0X1F;
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 2   

  55   1      }
  56          void relayon()//继电器开
  57          {P0=0x10;
  58   1       P2=(P2&0X1F)|0XA0;
  59   1       P2&=0X1F;
  60   1      }
  61          void relayoff()//继电器关
  62          {
  63   1         P0=0x00;
  64   1         P2=(P2&0X1F)|0XA0;
  65   1         P2&=0X1F;
  66   1      }
  67          
  68          void Timer0Init(void)   //1毫秒@11.0592MHz
  69          {
  70   1        AUXR |= 0x80;   //定时器时钟1T模式
  71   1        TMOD &= 0xF0;   //设置定时器模式
  72   1        TL0 = 0x9A;   //设置定时初值
  73   1        TH0 = 0xA9;   //设置定时初值
  74   1        TF0 = 0;    //清除TF0标志
  75   1        TR0 = 1;    //定时器0开始计时
  76   1      }
  77          
  78          
  79          
  80          void main()
  81          {
  82   1        Timer0Init();
  83   1        EA=1;
  84   1        ET0=1;
  85   1        ET1=1;
  86   1        ledoff();
  87   1        relayoff();
  88   1        while(1)
  89   1        { 
  90   2            if(Tflag==1)
  91   2            {
  92   3              wendu=duqu();
  93   3             Tflag=0;
  94   3            }
  95   2            if(keyflag1==0)
  96   2            {
  97   3            a1=0;
  98   3            }
  99   2            keyscan();
 100   2            panduan1();
 101   2            if(keyflag1==1)
 102   2            { 
 103   3              if(a2==0)
 104   3              {shezhi[0]=11;
 105   4              shezhi[5]=11;
 106   4              shezhi[1]=10;
 107   4              shezhi[2]=10;
 108   4              shezhi[3]=10;
 109   4              shezhi[4]=10;
 110   4              shezhi[6]=10;
 111   4              shezhi[7]=10;a2=1;
 112   4              sa[0]=10;
 113   4              sa[1]=10;
 114   4              sa[2]=10;
 115   4              sa[3]=10;
 116   4              
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 3   

 117   4              }
 118   3              if(keyflag!=0)
 119   3              {sa[a1]=keyvalue;
 120   4               a1++;
 121   4              shezhi[1]=sa[0];
 122   4              shezhi[2]=sa[1];
 123   4              shezhi[6]=sa[2];
 124   4              shezhi[7]=sa[3];
 125   4                
 126   4              }
 127   3              
 128   3              
 129   3             if((shezhi[1]*10+shezhi[2])<(shezhi[6]*10+shezhi[7])&&a1==4)
 130   3             {
 131   4                b7=1;
 132   4             }
 133   3             
 134   3             if(keyflag2==1)
 135   3             {
 136   4              a1=0;
 137   4              b7=0;
 138   4              sa[0]=10;
 139   4              sa[1]=10;
 140   4              sa[2]=10;
 141   4              sa[3]=10;
 142   4              shezhi[1]=sa[0];
 143   4              shezhi[2]=sa[1];
 144   4              shezhi[6]=sa[2];
 145   4              shezhi[7]=sa[3];
 146   4              keyflag2=0;
 147   4              ledoff1();
 148   4             }
 149   3             for(i=0;i<8;i++)
 150   3             {
 151   4                dspbuf[i]=shezhi[i];
 152   4             }
 153   3                s1=1;
 154   3            }
 155   2        }
 156   1      }
 157            
 158          void panduan1()
 159          {   
 160   1          if(keyflag1!=1)
 161   1          {
 162   2          s1=0;
 163   2          dspbuf[6]=wendu/10;
 164   2          dspbuf[7]=wendu%10;
 165   2          dspbuf[0]=11;
 166   2          dspbuf[2]=11;
 167   2          if(shezhi[1]*10+shezhi[2]<wendu)
 168   2          {
 169   3            dspbuf[1]=2;
 170   3          }
 171   2          
 172   2          else  if(shezhi[6]*10+shezhi[7]>wendu)
 173   2          {
 174   3            dspbuf[1]=0;
 175   3          }
 176   2        else  if(wendu>=shezhi[6]*10+shezhi[7]&&wendu<=shezhi[1]*10+shezhi[2])
 177   2          {
 178   3            dspbuf[1]=1;
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 4   

 179   3          }
 180   2        }
 181   1      }
 182          
 183          void keyscan()
 184          {
 185   1        keyflag=0;
 186   1        
 187   1        h1=0;h2=1;h3=1;h4=1;
 188   1          if(l1==0)
 189   1         {
 190   2            Delay5ms();
 191   2            if(l1==0)
 192   2           {
 193   3              while(!l1);
 194   3              keyvalue=0;keyflag=1;  
 195   3           }
 196   2         }
 197   1         if(l2==0)
 198   1          {
 199   2             Delay5ms();
 200   2             if(l2==0)
 201   2             {while(!l2);
 202   3               keyvalue=1;keyflag=1;   
 203   3             }
 204   2          }
 205   1       if(l3==0)
 206   1        {
 207   2            Delay5ms();
 208   2           if(l3==0)
 209   2           {
 210   3             while(!l3);
 211   3             keyvalue=2;
 212   3             keyflag=1;  
 213   3           }
 214   2        }
 215   1       
 216   1        h1=1;h2=0;h3=1;h4=1;
 217   1        if(l1==0)
 218   1       {
 219   2       Delay5ms();
 220   2         if(l1==0)
 221   2         {
 222   3         while(!l1);
 223   3           keyvalue=3;
 224   3           keyflag=1;  
 225   3         }
 226   2        }
 227   1         if(l2==0)
 228   1       {
 229   2       Delay5ms();
 230   2         if(l2==0)
 231   2         {
 232   3         while(!l2);
 233   3           keyvalue=4;
 234   3           keyflag=1;  
 235   3         }
 236   2        }
 237   1       if(l3==0)
 238   1       {
 239   2       Delay5ms();
 240   2         if(l3==0)
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 5   

 241   2         {
 242   3         while(!l3);
 243   3           keyvalue=5;
 244   3           keyflag=1;  
 245   3         }
 246   2       }
 247   1         
 248   1         h1=1;h2=1;h3=0;h4=1;
 249   1        if(l1==0)
 250   1       {
 251   2       Delay5ms();
 252   2         if(l1==0)
 253   2         {
 254   3         while(!l1);
 255   3           keyvalue=6;
 256   3           keyflag=1;  
 257   3         }
 258   2        }
 259   1         if(l2==0)
 260   1       {
 261   2       Delay5ms();
 262   2         if(l2==0)
 263   2         {
 264   3         while(!l2);
 265   3           keyvalue=7;
 266   3           keyflag=1;}
 267   2        }
 268   1       if(l3==0)
 269   1       {
 270   2       Delay5ms();
 271   2         if(l3==0)
 272   2         {
 273   3         while(!l3);
 274   3           keyvalue=8;
 275   3           keyflag=1;  
 276   3         }
 277   2        }
 278   1       h1=1;h2=1;h3=1;h4=0;
 279   1        if(l1==0)
 280   1       {
 281   2       Delay5ms();
 282   2         if(l1==0)
 283   2         {
 284   3         while(!l1);
 285   3           keyvalue=9;
 286   3           keyflag=1;  
 287   3         }
 288   2        }
 289   1         if(l2==0)
 290   1       {
 291   2       Delay5ms();
 292   2         if(l2==0)
 293   2         {
 294   3         while(!l2);
 295   3           keyvalue=10;
 296   3           keyflag1=1;
 297   3           if(s1==1&&a1==4&&b7==0)
 298   3           {
 299   4           s1=0;
 300   4           keyflag1=0;
 301   4           a2=0;
 302   4           }
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 6   

 303   3         }
 304   2        }
 305   1       if(l3==0)
 306   1       {
 307   2       Delay5ms();
 308   2         if(l3==0)
 309   2         {
 310   3         while(!l3);
 311   3           keyvalue=11;
 312   3           keyflag2=1;   
 313   3         }
 314   2        }
 315   1       
 316   1        
 317   1      } 
 318          
 319          
 320          void display()//显示函数
 321          {
 322   1         P0=0XFF;
 323   1         P2=(P2&0X1F)|0XE0;
 324   1         P2&=0X1F;
 325   1         
 326   1         P0=1<<dspcom;
 327   1         P2=(P2&0X1F)|0XC0;
 328   1         P2&=0X1F;
 329   1         
 330   1         P0=tab[dspbuf[dspcom]];
 331   1         P2=(P2&0X1F)|0XE0;
 332   1         P2=P2&0X1F;
 333   1        
 334   1        if(++dspcom==8)
 335   1         dspcom=0;    
 336   1      } 
 337          void T0()interrupt 1//中断响应T0
 338          {
 339   1        display();
 340   1       if(++a==50)//100ms启动一次温度转换
 341   1       {
 342   2       Tflag=1;
 343   2       a=0;
 344   2       }
 345   1       if(++a4==400)
 346   1         {
 347   2         a4=0;
 348   2         b4++;
 349   2         }
 350   1        if(++a5==200)
 351   1         {
 352   2         a5=0;b5++;
 353   2         }
 354   1         if(++a6==100)
 355   1         {
 356   2         a6=0;b6++;
 357   2         }
 358   1         if(b4==2)
 359   1         {
 360   2         b4=0;
 361   2         }
 362   1         if(b5==2)
 363   1         {
 364   2         b5=0;
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 7   

 365   2         }
 366   1         if(b6==2)
 367   1         {
 368   2         b6=0;
 369   2         }
 370   1        if(dspbuf[1]==0&&keyflag1==0&&b7==0)
 371   1          { 
 372   2            if(b4%2==0)
 373   2            {
 374   3            ledon();
 375   3            relayoff();
 376   3            }
 377   2            if(b4%2!=0)
 378   2            {
 379   3            ledoff();
 380   3            relayoff();
 381   3            }
 382   2          }
 383   1            
 384   1        if(dspbuf[1]==1&&keyflag1==0&&b7==0)
 385   1          { 
 386   2            if(b5%2==0)
 387   2            {
 388   3            ledon();
 389   3            relayoff();
 390   3            }
 391   2            if(b5%2!=0)
 392   2            {
 393   3            ledoff();
 394   3            relayoff();
 395   3            }
 396   2          }
 397   1          if(dspbuf[1]==2&&keyflag1==0&&b7==0)
 398   1          { 
 399   2            if(b6%2==0)
 400   2            {
 401   3            ledon();relayon();}
 402   2            if(b6%2!=0)
 403   2            {
 404   3            ledoff();
 405   3            relayon();
 406   3            }
 407   2          }
 408   1          if(b7==1)
 409   1          {
 410   2          ledon1();
 411   2          }
 412   1          if(keyflag1==1&&b7!=1)
 413   1          {
 414   2          ledoff();
 415   2          }
 416   1      
 417   1      }
 418            
 419          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1225    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.54   WUKANG                                                                12/17/2017 14:03:24 PAGE 8   

   DATA SIZE        =     57    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
