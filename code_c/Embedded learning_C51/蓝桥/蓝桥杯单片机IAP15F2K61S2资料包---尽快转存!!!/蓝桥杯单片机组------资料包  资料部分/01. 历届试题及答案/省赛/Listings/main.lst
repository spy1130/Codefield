C51 COMPILER V9.57.0.0   MAIN                                                              02/10/2020 15:14:16 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\keil~5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.
                    -lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <STC15F2K60S2.h>
   2          #include "ds1302.h"
   3          #include "onewire.h"
   4          #include "DS.h"
   5          
   6          sbit S7 = P3^0;    //进入采集时间设置页面
   7          sbit S6 = P3^1;    //
   8          sbit S5 = P3^2;    //确认采集时间，退出采集时间设置页面
   9          sbit S4 = P3^3;    //切换温度采集间隔时间
  10          
  11          bit s7_flag = 0;
  12          bit s6_flag = 0;
  13          bit s5_flag = 0;
  14          bit s4_flag = 0;
  15          
  16          bit L1_flag = 0; //0时L1不闪烁， 1闪烁
  17          bit tt3_flag = 0;
  18          bit tt2_flag = 0;
  19          
  20          bit f;
  21          unsigned char ChaTime = 0, tempCha = 0; 
  22          unsigned char Dsplaywei = 1;  
  23          unsigned char tt = 0, tt1 = 0, tt2 = 0, tt3 = 0;
  24          unsigned char Temperature[10];
  25          unsigned char cha[4] = {1, 5, 30, 60};
  26          void Delay5ms();
  27          void Keypress();
  28          void Timer0Init(void);
  29          void Close_BUZZ();
  30          void Timer1Init(void);    //10毫秒@11.0592MHz
  31          void main()
  32          {
  33   1         //选择温度检测时间间隔
  34   1       //1为温度设置页面，2为时钟页面，3为显示页面
  35   1      
  36   1        unsigned char tmperwei = 0;
  37   1        Close_BUZZ();
  38   1        Timer0Init();
  39   1        Init_DS1302();
  40   1        Timer1Init();
  41   1      
  42   1        while(1)
  43   1        {
  44   2          Keypress();
  45   2      
  46   2          if ((L1_flag == 1) && (tt3_flag))
  47   2          {
  48   3            P0 = 0xFF;
  49   3            P2 = 0x80;
  50   3            if (f == 0)
  51   3            {
  52   4              P00 = 1;
  53   4              f = ~f;
  54   4            }
C51 COMPILER V9.57.0.0   MAIN                                                              02/10/2020 15:14:16 PAGE 2   

  55   3            else
  56   3            {
  57   4              P00 = 0;  
  58   4              f = ~f;       
  59   4            } 
  60   3            P2 = 0x00;
  61   3          }
  62   2          
  63   2          
  64   2          if (s7_flag == 1)  
  65   2          {
  66   3            s7_flag = 0;
  67   3            
  68   3            if (Dsplaywei == 3)
  69   3            {
  70   4              Dsplaywei = 1;
  71   4            }   
  72   3          }
  73   2          
  74   2          if (s6_flag == 1)
  75   2          {
  76   3            s6_flag = 0;
  77   3            if (Dsplaywei == 3)
  78   3            {
  79   4              if (L1_flag == 1)
  80   4              {
  81   5                L1_flag = 0;
  82   5              }
  83   4              
  84   4              tmperwei++; 
  85   4              if (tmperwei == 10)
  86   4              {
  87   5                tmperwei = 0;
  88   5              }
  89   4            }
  90   3          }
  91   2          
  92   2          if (s5_flag == 1)
  93   2          {
  94   3            s5_flag = 0;
  95   3            if (Dsplaywei == 1)
  96   3            {
  97   4              Dsplaywei = 2;  
  98   4              ChaTime = tempCha;
  99   4              TR0 = 1;
 100   4              Temperature[tt2] = rd_temperature();
 101   4            }
 102   3          }
 103   2      
 104   2          if (s4_flag == 1)
 105   2          {
 106   3            s4_flag = 0;
 107   3            
 108   3            if (Dsplaywei == 1)
 109   3            {
 110   4              tempCha++;  
 111   4              if (tempCha == 4)
 112   4              {
 113   5                tempCha = 0;
 114   5              } 
 115   4            } 
 116   3          } 
C51 COMPILER V9.57.0.0   MAIN                                                              02/10/2020 15:14:16 PAGE 3   

 117   2          
 118   2          if (tt2_flag == 1)
 119   2          {
 120   3            tt2_flag = 0;
 121   3            Temperature[tt2] = rd_temperature();
 122   3            Dsplaywei = 3;
 123   3            L1_flag = 1;
 124   3          }
 125   2          
 126   2          if (Dsplaywei == 1)
 127   2          {
 128   3            DS1(10,10);
 129   3            DS2(10);
 130   3            DS3(10,10);
 131   3            DS4(11);
 132   3            DS5(cha[tempCha]/10,cha[tempCha]%10);
 133   3          }
 134   2          
 135   2          if (Dsplaywei == 2)
 136   2          {
 137   3            Read_DS1302();
 138   3            DS1(DisplayTime[0]>>4,DisplayTime[0]&0x0F);
 139   3            if (tt3_flag)
 140   3            {
 141   4              DS2(11);
 142   4              DS4(11);
 143   4            }
 144   3            else
 145   3            {
 146   4              DS2(10);
 147   4              DS4(10);
 148   4            }
 149   3            DS3(DisplayTime[1]>>4,DisplayTime[1]&0x0F); 
 150   3            DS5(DisplayTime[2]>>4,DisplayTime[2]&0x0F);
 151   3          }
 152   2          
 153   2          if (Dsplaywei == 3)
 154   2          {
 155   3            DS1(11,0);
 156   3            DS2(tmperwei);
 157   3            DS3(10,10);
 158   3            DS4(11);
 159   3            DS5(Temperature[tmperwei]/10,Temperature[tmperwei]%10);
 160   3          }   
 161   2        }
 162   1      }
 163          
 164          void Close_BUZZ()
 165          {
 166   1        P2 = 0xA0;
 167   1        P0 = 0x00;
 168   1        P2 = 0x80;
 169   1        P0 = 0xFF;
 170   1        P2 = 0x00;
 171   1      }
 172          
 173          void Delay5ms()   //@11.0592MHz
 174          {
 175   1        unsigned char i, j;
 176   1      
 177   1        i = 54;
 178   1        j = 199;
C51 COMPILER V9.57.0.0   MAIN                                                              02/10/2020 15:14:16 PAGE 4   

 179   1        do
 180   1        {
 181   2          while (--j);
 182   2        } while (--i);
 183   1      }
 184          
 185          void Keypress()
 186          {
 187   1        if (S7 == 0)
 188   1        {
 189   2          Delay5ms();
 190   2          if (S7 == 0)
 191   2          {
 192   3            s7_flag = 1;
 193   3          }
 194   2          while(S7 == 0);
 195   2        }
 196   1        
 197   1        if (S6 == 0)
 198   1        {
 199   2          Delay5ms();
 200   2          if (S6 == 0)
 201   2          {
 202   3            s6_flag = 1;
 203   3          }
 204   2          while(S6 == 0);
 205   2        }
 206   1        
 207   1        if (S5 == 0)
 208   1        {
 209   2          Delay5ms();
 210   2          if (S5 == 0)
 211   2          {
 212   3            s5_flag = 1;
 213   3          }
 214   2          while(S5 == 0);
 215   2        } 
 216   1          
 217   1        if (S4 == 0)
 218   1        {
 219   2          Delay5ms();
 220   2          if (S4 == 0)
 221   2          {
 222   3            s4_flag = 1;
 223   3          }
 224   2          while(S4 == 0);
 225   2        }
 226   1      }
 227          
 228          void Timer0Init(void)   //10毫秒@11.0592MHz 
 229          {
 230   1        AUXR &= 0x7F;   //定时器时钟12T模式
 231   1        TMOD &= 0xF0;   //设置定时器模式
 232   1        TMOD |= 0x01;   //设置定时器模式
 233   1        TL0 = 0x00;   //设置定时初值
 234   1        TH0 = 0xDC;   //设置定时初值
 235   1        TF0 = 0;    //清除TF0标志
 236   1        
 237   1        ET0 = 1;
 238   1        EA = 1;
 239   1      }
 240          
C51 COMPILER V9.57.0.0   MAIN                                                              02/10/2020 15:14:16 PAGE 5   

 241          void Timer0interrupt() interrupt 1
 242          {
 243   1        if (++tt == 100) //1秒
 244   1        {
 245   2          tt = 0;
 246   2          if (++tt1 == cha[ChaTime])
 247   2          {
 248   3            tt1 = 0;
 249   3            tt2_flag = 1;
 250   3            tt2++;
 251   3            if (tt2 == 9)
 252   3            {
 253   4              TL0 = 0x00;   //设置定时初值
 254   4              TH0 = 0xDC;   //设置定时初值
 255   4              TR0 = 0;
 256   4              tt2 = 0;
 257   4            }
 258   3            else
 259   3            {
 260   4              TL0 = 0x00;   //设置定时初值
 261   4              TH0 = 0xDC;   //设置定时初值        
 262   4            }
 263   3          }
 264   2        }
 265   1        TF0 = 0;
 266   1      }
 267          
 268          
 269          void Timer1Init(void)   //10毫秒@11.0592MHz
 270          {
 271   1        AUXR &= 0xBF;   //定时器时钟12T模式
 272   1        TMOD &= 0x0F;   //设置定时器模式
 273   1        TL1 = 0x00;   //设置定时初值
 274   1        TH1 = 0xDC;   //设置定时初值
 275   1        TF1 = 0;    //清除TF1标志
 276   1        TR1 = 1;    //定时器1开始计时
 277   1        
 278   1        ET1 = 1;
 279   1        EA = 1;
 280   1      }
 281          
 282          void Timer1interrupt() interrupt 3
 283          {
 284   1        if (++tt3 == 100) //1秒
 285   1        {
 286   2      
 287   2          
 288   2          tt3_flag = ~tt3_flag;
 289   2          
 290   2        }
 291   1      }
 292          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    546    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      8    ----
C51 COMPILER V9.57.0.0   MAIN                                                              02/10/2020 15:14:16 PAGE 6   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
