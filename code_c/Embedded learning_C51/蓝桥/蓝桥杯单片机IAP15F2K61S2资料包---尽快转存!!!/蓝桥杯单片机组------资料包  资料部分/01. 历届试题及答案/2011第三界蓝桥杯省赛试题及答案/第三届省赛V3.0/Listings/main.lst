C51 COMPILER V9.54   MAIN                                                                  12/21/2017 16:00:02 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\keil   55\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /**************************************************************************
   2          实验功能：第三届省赛试题程序设计
   3          时间：2017.12.21
   4          作者：吴康
   5          ***************************************************************************/
   6          #include <STC15F2K60S2.H>
   7          #include <intrins.h>
   8          #include <iic.h>
   9          
  10          #define uchar unsigned char 
  11          #define uint unsigned int 
  12            
  13          sbit scl=P2^0;
  14          sbit sda=P2^1;
  15          
  16          uchar code tab[]={0XC0,0XF9,0XA4,0XB0,0X99,0X92,0X82,0XF8,0X80,0X90,0XFF};
  17          uchar code dot[]={0X40,0x79,0x24,0x30,0x19,0x12,0x20,0x78,0x00,0x10};
  18          
  19          uchar yi,er,san,si,wu ,liu,qi,ba;
  20          uchar tt=0;
  21          uint ML=0;
  22          uint money=0;
  23          uchar guan=0;
  24          
  25          /**************************************************************************
  26          函数名称：delayms
  27          功能：延时函数
  28          ***************************************************************************/
  29          void delayms(int ms)
  30          {
  31   1        int i,j;
  32   1        for(i=ms;i>0;i--)
  33   1          for(j=845;j>0;j--);
  34   1      }
  35          
  36          /**************************************************************************
  37          函数名称：allinit
  38          功能：板子整体初始化函数
  39          ***************************************************************************/
  40          void allinit()
  41          {
  42   1        P2=0XA0;
  43   1        P0=0X00;//关闭蜂鸣器，继电器
  44   1        
  45   1        P2=0X80;
  46   1        P0=0XFF;//关闭LED灯
  47   1        
  48   1        P2=0XC0;
  49   1        P0=0XFF;//选择所有数码管
  50   1        P2=0XFF;
  51   1        P0=0XFF;//关闭所有数码管
  52   1      }
  53          
  54          /**************************************************************************
C51 COMPILER V9.54   MAIN                                                                  12/21/2017 16:00:02 PAGE 2   

  55          函数名称：display
  56          功能：显示函数
  57          ***************************************************************************/
  58          void display1(uchar yi,uchar er)
  59          {
  60   1          P2=0XC0;//打开位选573   U8
  61   1          P0=0X01;//选择第一个数码管
  62   1          P2=0XFF;//打开段选573   U7
  63   1          P0=tab[yi];
  64   1          delayms(1);
  65   1          
  66   1          P2=0XC0;//打开位选573   U8
  67   1          P0=0X02;//选择第二个数码管
  68   1          P2=0XFF;//打开段选573   U7
  69   1          P0=dot[er];
  70   1          delayms(1);
  71   1      } 
  72          
  73          void display2(uchar san,uchar si)
  74          {
  75   1          P2=0XC0;//打开位选573   U8
  76   1          P0=0X04;//选择第三个数码管
  77   1          P2=0XFF;//打开段选573   U7
  78   1          P0=tab[san];
  79   1          delayms(1);
  80   1          
  81   1          P2=0XC0;//打开位选573   U8
  82   1          P0=0X08;//选择第四个数码管
  83   1          P2=0XFF;//打开段选573   U7
  84   1          P0=tab[si];
  85   1          delayms(1);
  86   1      }
  87          
  88          void display3(uchar wu,uchar liu)
  89          {
  90   1          P2=0XC0;//打开位选573   U8
  91   1          P0=0X10;//选择第一个数码管
  92   1          P2=0XFF;//打开段选573   U7
  93   1          P0=tab[wu];
  94   1          delayms(1);
  95   1          
  96   1          P2=0XC0;//打开位选573   U8
  97   1          P0=0X20;//选择第一个数码管
  98   1          P2=0XFF;//打开段选573   U7
  99   1          P0=dot[liu];
 100   1          delayms(1);
 101   1      }
 102          
 103          void display4(uchar qi,uchar ba)
 104          {
 105   1          P2=0XC0;//打开位选573   U8
 106   1          P0=0X40;//选择第一个数码管
 107   1          P2=0XFF;//打开段选573   U7
 108   1          P0=tab[qi];
 109   1          delayms(1);
 110   1          
 111   1          P2=0XC0;//打开位选573   U8
 112   1          P0=0X80;//选择第一个数码管
 113   1          P2=0XFF;//打开段选573   U7
 114   1          P0=tab[ba];
 115   1          delayms(1);
 116   1      }
C51 COMPILER V9.54   MAIN                                                                  12/21/2017 16:00:02 PAGE 3   

 117          
 118          /**************************************************************************
 119          函数名称：Timer0Init
 120          功能：定时器0初始化函数
 121          ***************************************************************************/
 122          void Timer0Init(void)   //5毫秒@11.0592MHz
 123          {
 124   1        AUXR |= 0x80;   //定时器时钟1T模式
 125   1        TMOD &= 0xF0;   //设置定时器模式
 126   1        TL0 = 0x00;   //设置定时初值
 127   1        TH0 = 0x28;   //设置定时初值
 128   1        TF0 = 0;    //清除TF0标志
 129   1        TR0 = 1;    //定时器0开始计时
 130   1      }
 131          
 132          /**************************************************************************
 133          函数名称：rel
 134          功能：初始化函数
 135          ***************************************************************************/
 136          void rel(uchar dong)
 137          {
 138   1        if(dong==0)
 139   1        {
 140   2          P2=0XA0;P0=0X00;//全关
 141   2        }
 142   1        else if(dong==1)
 143   1        {
 144   2          P2=0XA0;P0=0X40;//开蜂鸣器 
 145   2        }
 146   1        else if(dong==2)
 147   1        {
 148   2          P2=0XA0;P0=0X10;//开继电器
 149   2        }
 150   1        else if(dong==3)
 151   1        {
 152   2          P2=0XA0;P0=0Xff;//全开
 153   2        }
 154   1      }
 155          
 156          /**************************************************************************
 157          函数名称：keyscan
 158          功能：按键扫描函数
 159          ***************************************************************************/
 160          void keyscan()
 161          {
 162   1        if(P30==0)
 163   1        {
 164   2          delayms(5);
 165   2          if(P30==0)
 166   2          {
 167   3            rel(2);
 168   3            wu=0;
 169   3            liu=0;
 170   3            qi=0;
 171   3            ba=0;
 172   3            EA=1;
 173   3            ET0=1;
 174   3          }
 175   2          while(!P30);
 176   2        }
 177   1        else if(P31==0)
 178   1        {
C51 COMPILER V9.54   MAIN                                                                  12/21/2017 16:00:02 PAGE 4   

 179   2          delayms(5);
 180   2          if(P31==0)
 181   2          {
 182   3            EA=0;
 183   3            ET0=0;
 184   3            rel(0);
 185   3            money=ML*5;
 186   3            wu=money/100000;
 187   3            liu=money%100000/10000;
 188   3            qi=money%10000/1000;
 189   3            ba=money%1000/100;
 190   3            ML=0; 
 191   3          }
 192   2          while(!P31);
 193   2        }
 194   1      }
 195          
 196          /**************************************************************************
 197          函数名称：adrun
 198          功能：采集光敏电阻电压函数
 199          ***************************************************************************/
 200          void adrun()
 201          {
 202   1        uchar num;
 203   1        num=iicread(0x01);
 204   1        if(num<25)
 205   1        {
 206   2          P2=0X80;P0=0XFE;
 207   2        }
 208   1        else 
 209   1        {
 210   2          P2=0X80;P0=0XFF;
 211   2        }
 212   1      }
 213          
 214          /**************************************************************************
 215          函数名称：main
 216          功能：主函数
 217          ***************************************************************************/
 218          void main()
 219          {
 220   1        allinit();
 221   1        Timer0Init();
 222   1        
 223   1        yi=10;er=0;san=5;si=0;wu=0;liu=0;qi=0;ba=0;
 224   1        while(1)
 225   1        {
 226   2          adrun();
 227   2          keyscan();
 228   2          display1(yi,er);
 229   2          display2(san,si);
 230   2          display3(wu,liu);
 231   2          display4(qi,ba);
 232   2        }
 233   1      }
 234          
 235          /**************************************************************************
 236          函数名称：time0
 237          功能：中断服务函数
 238          ***************************************************************************/
 239          void time0() interrupt 1
 240          {
C51 COMPILER V9.54   MAIN                                                                  12/21/2017 16:00:02 PAGE 5   

 241   1        tt++;
 242   1        if(tt==20)
 243   1        {
 244   2          tt=0;
 245   2          ML=ML+10;
 246   2          wu=ML/10000;
 247   2          liu=ML%10000/1000;
 248   2          qi=ML%1000/100;
 249   2          ba=ML%100/10;//qiu=ML%10;
 250   2          if(ML>99990)
 251   2          {
 252   3            EA=0;
 253   3            ET0=0;
 254   3            rel(0);
 255   3            money=ML*5;
 256   3            wu=money/100000;
 257   3            liu=money%100000/10000;
 258   3            qi=money%10000/1000;
 259   3            ba=money%1000/100;
 260   3            ML=0; 
 261   3          }
 262   2        }
 263   1      }
 264          
 265          
 266          
 267          
 268          
 269          
 270          
 271          
 272          
 273          
 274          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    850    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
